<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Introduction to PopED &bull; PopED</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">PopED</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/intro-poped.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/andrewhooker/PopED">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Introduction to PopED</h1>
                        <h4 class="author">Andrew Hooker</h4>
            
            <h4 class="date">2016-12-16</h4>
          </div>

    
    
<div class="contents">
<p>PopED computes optimal experimental designs for both population and individual studies based on nonlinear mixed-effect models. Often this is based on a computation of the Fisher Information Matrix (FIM).</p>
<p>To get started you need to define</p>
<ul><li>A model.</li>
<li>An initial design (and design space if you want to optimize)</li>
<li>The tasks to perform.</li>
</ul><p>There are a number of functions to help you with these tasks. See <code><a href="../reference/PopED.html">?poped</a></code> for more information.</p>
<p>Below is an example to introduce the package. There are several other examples, as r-scripts, in the &ldquo;examples&rdquo; folder in the PopED installation directory located at:</p>
<pre><code>system.file("examples", package="PopED")</code></pre>
<div id="define-a-model" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#define-a-model" class="anchor"> </a></body></html>Define a model</h2>
<p>Here we define a one-compartment pharmacokinetic model with linear absorption using an analytical solution. In this case the solution is applicable for both multiple and single dosing. Note that this function is also predefined in PopED as <code>ff.PK.1.comp.oral.md.CL</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(PopED)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ff &lt;-<span class="st"> </span>function(model_switch,xt,parameters,poped.db){
  <span class="kw">with</span>(<span class="kw">as.list</span>(parameters),{
    N =<span class="st"> </span><span class="kw">floor</span>(xt/TAU)+<span class="dv">1</span>
    y=(DOSE*Favail/V)*(KA/(KA -<span class="st"> </span>CL/V)) *<span class="st"> </span>
<span class="st">      </span>(<span class="kw">exp</span>(-CL/V *<span class="st"> </span>(xt -<span class="st"> </span>(N -<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span>TAU)) *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span><span class="kw">exp</span>(-N *<span class="st"> </span>CL/V *<span class="st"> </span>TAU))/(<span class="dv">1</span> -<span class="st"> </span><span class="kw">exp</span>(-CL/V *<span class="st"> </span>TAU)) -<span class="st"> </span>
<span class="st">         </span><span class="kw">exp</span>(-KA *<span class="st"> </span>(xt -<span class="st"> </span>(N -<span class="st"> </span><span class="dv">1</span>) *<span class="st"> </span>TAU)) *<span class="st"> </span>(<span class="dv">1</span> -<span class="st"> </span><span class="kw">exp</span>(-N *<span class="st"> </span>KA *<span class="st"> </span>TAU))/(<span class="dv">1</span> -<span class="st"> </span><span class="kw">exp</span>(-KA *<span class="st"> </span>TAU)))  
    <span class="kw">return</span>(<span class="kw">list</span>( <span class="dt">y=</span>y,<span class="dt">poped.db=</span>poped.db))
  })
}</code></pre></div>
<p>Next we define the parameters of this function, in this case log-normal distributions around the parameters (not <code>Favail</code>). <code>DOSE</code> and <code>TAU</code> are defined as a covariates (<code>a</code>) so that we can optimize these values later.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sfg &lt;-<span class="st"> </span>function(x,a,bpop,b,bocc){
  parameters=<span class="kw">c</span>( <span class="dt">V=</span>bpop[<span class="dv">1</span>]*<span class="kw">exp</span>(b[<span class="dv">1</span>]),
                <span class="dt">KA=</span>bpop[<span class="dv">2</span>]*<span class="kw">exp</span>(b[<span class="dv">2</span>]),
                <span class="dt">CL=</span>bpop[<span class="dv">3</span>]*<span class="kw">exp</span>(b[<span class="dv">3</span>]),
                <span class="dt">Favail=</span>bpop[<span class="dv">4</span>],
                <span class="dt">DOSE=</span>a[<span class="dv">1</span>],
                <span class="dt">TAU=</span>a[<span class="dv">2</span>])
}</code></pre></div>
<p>Now we define the residual unexplained variability (RUV) function, in this case the RUV has both an additive and proportional component.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">feps &lt;-<span class="st"> </span>function(model_switch,xt,parameters,epsi,poped.db){
  returnArgs &lt;-<span class="st"> </span><span class="kw">ff</span>(model_switch,xt,parameters,poped.db) 
  y &lt;-<span class="st"> </span>returnArgs[[<span class="dv">1</span>]]
  poped.db &lt;-<span class="st"> </span>returnArgs[[<span class="dv">2</span>]]
 
  y =<span class="st"> </span>y*(<span class="dv">1</span>+epsi[,<span class="dv">1</span>])+epsi[,<span class="dv">2</span>]
  
  <span class="kw">return</span>(<span class="kw">list</span>(<span class="dt">y=</span>y,<span class="dt">poped.db=</span>poped.db)) 
}</code></pre></div>
<p>We have now defined all aspects of the model.</p>
</div>
<div id="define-an-initial-design-and-design-space" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#define-an-initial-design-and-design-space" class="anchor"> </a></body></html>Define an initial design and design space</h2>
<p>Now we define the model parameter values, the initial design and design space for optimization.</p>
<p>In this example, the parameter values are defined for the fixed effects (<code>bpop</code>), the between-subject variability variances (<code>d</code>) and the residual variability variances (<code>sigma</code>). We also fix the parameter <code>Favail</code> using <code>notfixed_bpop</code>, since we have only oral dosing and the parameter is not identifiable. Fixing a parameter means that we assume the parameter will not be estimated. In addition, we fix the small additive RUV term, as this term is reflecting the higher error expected at low concentration measurements (limit of quantification measurements) and would typically be calculated from analytical assay methods (for example, the standard deviation of the parameter might be 20% of the limit of quantification).</p>
<p>For the initial design, we define two groups (<code>m=2</code>) of 20 individuals (<code>groupsize=20</code>), with doses of 20 mg or 40 mg every 24 hours (<code>a</code>). The initial design has 5 sample times per individual (<code>xt</code>). For the design space, which can be searched during optimization, we define a potential dose range of between 0 and 200 mg (<code>mina</code> and <code>maxa</code>), and a range of potential sample times between 0 and 10 hours for the first three samples and between 240 and 248 hours for the last two samples (<code>minxt</code> and <code>maxxt</code>). Finally, we fix the two groups of subjects to have the sample sample times (<code>bUseGrouped_xt=TRUE</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">poped.db &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="dt">ff_fun=</span>ff,
                                  <span class="dt">fg_fun=</span>sfg,
                                  <span class="dt">fError_fun=</span>feps,
                                  <span class="dt">bpop=</span><span class="kw">c</span>(<span class="dt">V=</span><span class="fl">72.8</span>,<span class="dt">KA=</span><span class="fl">0.25</span>,<span class="dt">CL=</span><span class="fl">3.75</span>,<span class="dt">Favail=</span><span class="fl">0.9</span>), 
                                  <span class="dt">notfixed_bpop=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),
                                  <span class="dt">d=</span><span class="kw">c</span>(<span class="dt">V=</span><span class="fl">0.09</span>,<span class="dt">KA=</span><span class="fl">0.09</span>,<span class="dt">CL=</span><span class="fl">0.25</span>^<span class="dv">2</span>), 
                                  <span class="dt">sigma=</span><span class="kw">c</span>(<span class="fl">0.04</span>,<span class="fl">5e-6</span>),
                                  <span class="dt">notfixed_sigma=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),
                                  <span class="dt">m=</span><span class="dv">2</span>,
                                  <span class="dt">groupsize=</span><span class="dv">20</span>,
                                  <span class="dt">a=</span><span class="kw">list</span>(<span class="kw">c</span>(<span class="dt">DOSE=</span><span class="dv">20</span>,<span class="dt">TAU=</span><span class="dv">24</span>),<span class="kw">c</span>(<span class="dt">DOSE=</span><span class="dv">40</span>, <span class="dt">TAU=</span><span class="dv">24</span>)),
                                  <span class="dt">maxa=</span><span class="kw">c</span>(<span class="dt">DOSE=</span><span class="dv">200</span>,<span class="dt">TAU=</span><span class="dv">24</span>),
                                  <span class="dt">mina=</span><span class="kw">c</span>(<span class="dt">DOSE=</span><span class="dv">0</span>,<span class="dt">TAU=</span><span class="dv">24</span>),
                                  <span class="dt">xt=</span><span class="kw">c</span>( <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">240</span>,<span class="dv">245</span>),
                                  <span class="dt">minxt=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">240</span>,<span class="dv">240</span>),
                                  <span class="dt">maxxt=</span><span class="kw">c</span>(<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">248</span>,<span class="dv">248</span>),
                                  <span class="dt">bUseGrouped_xt=</span><span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="the-tasks-to-perform-" class="section level2">
<h2 class="hasAnchor"><html><body><a href="#the-tasks-to-perform-" class="anchor"> </a></body></html>The tasks to perform.</h2>
<div id="simulation" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#simulation" class="anchor"> </a></body></html>Simulation</h3>
<p>First it may make sense to check your model and design to make sure you get what you expect when simulating data. Here we plot the model typical values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db, <span class="dt">model_num_points =</span> <span class="dv">500</span>)</code></pre></div>
<p><img src="intro-poped_files/figure-html/unnamed-chunk-6-1.png" width="576"></p>
<p>Next, we plot the model typical values prediction intervals taking into account the between-subject variability (you can even investigate the effects of the residual, unexplained, variability with the <code>DV=T</code> argument):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db, <span class="dt">model_num_points=</span><span class="dv">500</span>, <span class="dt">IPRED=</span>T)</code></pre></div>
<p><img src="intro-poped_files/figure-html/simulate_with_BSV-1.png" width="576"></p>
<p>We can get these predictions numerically as well:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_prediction.html">model_prediction</a></span>(poped.db,<span class="dt">DV=</span>T)
<span class="kw">head</span>(dat,<span class="dt">n=</span><span class="dv">5</span>);<span class="kw">tail</span>(dat,<span class="dt">n=</span><span class="dv">5</span>)</code></pre></div>
<pre><code>##   ID Time         DV      IPRED       PRED Group Model DOSE TAU
## 1  1    1 0.06244399 0.04711725 0.05325024     1     1   20  24
## 2  1    2 0.10420418 0.08029606 0.09204804     1     1   20  24
## 3  1    8 0.15663209 0.12889021 0.16409609     1     1   20  24
## 4  1  240 0.07326620 0.05574708 0.12671376     1     1   20  24
## 5  1  245 0.13040197 0.16353435 0.24980320     1     1   20  24</code></pre>
<pre><code>##     ID Time        DV     IPRED      PRED Group Model DOSE TAU
## 196 40    1 0.1020287 0.1184551 0.1065005     2     1   40  24
## 197 40    2 0.2095036 0.2032263 0.1840961     2     1   40  24
## 198 40    8 0.3207346 0.3617878 0.3281922     2     1   40  24
## 199 40  240 0.5282674 0.4505295 0.2534275     2     1   40  24
## 200 40  245 0.9379442 0.7140960 0.4996064     2     1   40  24</code></pre>
</div>
<div id="design-evaluation" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#design-evaluation" class="anchor"> </a></body></html>Design evaluation</h3>
<p>Next, we evaluate the initial design</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db)</code></pre></div>
<pre><code>## $ofv
## [1] 39.309
## 
## $fim
##             [,1]        [,2]         [,3]       [,4]       [,5]
## [1,]  0.05336692   -8.683963  -0.05863412   0.000000   0.000000
## [2,] -8.68396266 2999.851007 -14.43058560   0.000000   0.000000
## [3,] -0.05863412  -14.430586  37.15243290   0.000000   0.000000
## [4,]  0.00000000    0.000000   0.00000000 999.953587 312.240246
## [5,]  0.00000000    0.000000   0.00000000 312.240246 439.412556
## [6,]  0.00000000    0.000000   0.00000000   3.202847   2.287838
## [7,]  0.00000000    0.000000   0.00000000 575.347261 638.581909
##             [,6]       [,7]
## [1,]    0.000000     0.0000
## [2,]    0.000000     0.0000
## [3,]    0.000000     0.0000
## [4,]    3.202847   575.3473
## [5,]    2.287838   638.5819
## [6,] 3412.005199  1182.3255
## [7,] 1182.325475 33864.3226
## 
## $rse
##    bpop[1]    bpop[2]    bpop[3]     D[1,1]     D[2,2]     D[3,3] 
##   8.215338  10.090955   4.400304  39.844763  60.655110  27.562541 
## SIGMA[1,1] 
##  13.865357</code></pre>
<p>We see that the fixed-effect and residual variability parameters are relatively well estimated with this design, but the between-subject variability parameters are less well estimated.</p>
</div>
<div id="design-optimization" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#design-optimization" class="anchor"> </a></body></html>Design optimization</h3>
<p>Now we can optimize the sample times of the design<a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output &lt;-<span class="st"> </span><span class="kw"><a href="../reference/poped_optim.html">poped_optim</a></span>(poped.db, <span class="dt">opt_xt=</span>T)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(output)</code></pre></div>
<pre><code>## ===============================================================================
## FINAL RESULTS
## Optimized Sampling Schedule
## Group 1 : 0.4574     10     10    240  240.9
## Group 2 : 0.4574     10     10    240  240.9
## 
## OFV = 40.5277
## 
## Efficiency: 
##   ((exp(ofv_final) / exp(ofv_init))^(1/n_parameters)) = 1.1902
## 
## Expected parameter 
## relative standard error (%RSE):
##     Parameter    Values   RSE_0     RSE
##       bpop[1]   72.8000    8.22    6.28
##       bpop[2]    0.2500   10.09    7.74
##       bpop[3]    3.7500    4.40    4.29
##        D[1,1]    0.0900   39.84   32.54
##        D[2,2]    0.0900   60.66   50.44
##        D[3,3]    0.0625   27.56   26.44
##    SIGMA[1,1]    0.0400   13.87   14.80
## 
## Total running time: 34.634 seconds</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(output$poped.db)</code></pre></div>
<p><img src="intro-poped_files/figure-html/unnamed-chunk-9-1.png" width="576"></p>
<p>We see that there are four distinct sample times for this design. This means that for this model, with these exact parameter values, that the most information from the study to inform the parameter estimation is with these sample times.</p>
</div>
<div id="examine-efficiency-of-sampling-windows" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#examine-efficiency-of-sampling-windows" class="anchor"> </a></body></html>Examine efficiency of sampling windows</h3>
<p>Of course, this means that there are multiple samples at some of these time points. We can explore a more practical design by looking at the loss of efficiency if we spread out sample times in a uniform distribution around these optimal points (<span class="math inline">\(\pm 30\)</span> minutes).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_efficiency_of_windows.html">plot_efficiency_of_windows</a></span>(output$poped.db,<span class="dt">xt_windows=</span><span class="fl">0.5</span>)</code></pre></div>
<p><img src="intro-poped_files/figure-html/unnamed-chunk-10-1.png" width="576"></p>
<p>Here we see the efficiency (<span class="math inline">\((|FIM_{optimized}|/|FIM_{initial}|)^{1/npar}\)</span>) drop below 80% in some cases, which is mostly caused by an increase in the D[2,2] parameter uncertainty (BSV on absorption). Smaller windows or different windowing on different samples may be in order here. To investigate see <code><a href="../reference/plot_efficiency_of_windows.html">?plot_efficiency_of_windows</a></code>.</p>
</div>
<div id="optimize-over-a-discrete-design-space" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#optimize-over-a-discrete-design-space" class="anchor"> </a></body></html>Optimize over a discrete design space</h3>
<p>In the previous example we optimized over a continuous design space (sample times could be optimized to be any value between a lower and an upper limit). We could also limit the search to only &ldquo;allowed&rdquo; values, for example, only samples taken on the hour are allowed.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">poped.db.discrete &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(poped.db,<span class="dt">discrete_xt =</span> <span class="kw">list</span>(<span class="dv">0</span>:<span class="dv">248</span>))
                                          
output_discrete &lt;-<span class="st"> </span><span class="kw"><a href="../reference/poped_optim.html">poped_optim</a></span>(poped.db.discrete, <span class="dt">opt_xt=</span>T)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(output_discrete)</code></pre></div>
<pre><code>## ===============================================================================
## FINAL RESULTS
## Optimized Sampling Schedule
## Group 1 :      1     10     10    240    241
## Group 2 :      1     10     10    240    241
## 
## OFV = 40.3782
## 
## Efficiency: 
##   ((exp(ofv_final) / exp(ofv_init))^(1/n_parameters)) = 1.165
## 
## Expected parameter 
## relative standard error (%RSE):
##     Parameter    Values   RSE_0     RSE
##       bpop[1]   72.8000    8.22    6.33
##       bpop[2]    0.2500   10.09    8.01
##       bpop[3]    3.7500    4.40    4.30
##        D[1,1]    0.0900   39.84   32.46
##        D[2,2]    0.0900   60.66   53.33
##        D[3,3]    0.0625   27.56   26.52
##    SIGMA[1,1]    0.0400   13.87   14.68
## 
## Total running time: 16.206 seconds</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(output_discrete$poped.db)</code></pre></div>
<p><img src="intro-poped_files/figure-html/unnamed-chunk-12-1.png" width="576"></p>
<p>Here we see that the optimization ran somewhat quicker, but gave a less efficient design.</p>
</div>
<div id="optimize-other-design-variables" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#optimize-other-design-variables" class="anchor"> </a></body></html>Optimize &lsquo;Other&rsquo; design variables</h3>
<p>One could also optimize over dose, to see if a different dose could help in parameter estimation .</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output_dose_opt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/poped_optim.html">poped_optim</a></span>(output$poped.db, <span class="dt">opt_xt=</span>T, <span class="dt">opt_a=</span>T)</code></pre></div>
<p>In this case the results are predictable &hellip; higher doses give observations with somewhat lower absolute residual variability leading to both groups at the highest allowed dose levels (200 mg in this case).</p>
</div>
<div id="cost-function-to-optimize-dose" class="section level3">
<h3 class="hasAnchor"><html><body><a href="#cost-function-to-optimize-dose" class="anchor"> </a></body></html>Cost function to optimize dose</h3>
<p>Optimizing the dose of a study just to have better model parameter estimates may be somewhat implausible. Instead, let&rsquo;s use a cost function to optimize dose based on some sort of target concentration &hellip; perhaps typical population trough concentrations of 0.2 and 0.35 for the two groups of patients at 240 hours.</p>
<p>First we define the criteria we use to optimize the doses, here a least squares minimization.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">crit_fcn &lt;-<span class="st"> </span>function(poped.db,...){
  pred_df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/model_prediction.html">model_prediction</a></span>(poped.db)
  <span class="kw">sum</span>((pred_df[pred_df[<span class="st">"Time"</span>]==<span class="dv">240</span>,<span class="st">"PRED"</span>] -<span class="st"> </span><span class="kw">c</span>(<span class="fl">0.2</span>,<span class="fl">0.35</span>))^<span class="dv">2</span>)
}
<span class="kw">crit_fcn</span>(output$poped.db)</code></pre></div>
<pre><code>## [1] 0.01469712</code></pre>
<p>Now we minimize the cost function</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">output_cost &lt;-<span class="st"> </span><span class="kw"><a href="../reference/poped_optim.html">poped_optim</a></span>(poped.db, <span class="dt">opt_a =</span>T, <span class="dt">opt_xt =</span> F,
                     <span class="dt">ofv_fun=</span>crit_fcn,
                     <span class="dt">maximize =</span> F)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(output_cost)</code></pre></div>
<pre><code>## ===============================================================================
## FINAL RESULTS
## 
## Optimized Covariates:
## Group 1: 31.5672 : 24
## Group 2: 55.2426 : 24
## 
## OFV = 7.70372e-34
## 
## Efficiency: 
##   (ofv_final / ofv_init) = 5.2417e-32
## 
## Expected parameter 
## relative standard error (%RSE):
##     Parameter    Values   RSE_0     RSE
##       bpop[1]   72.8000    8.22    8.21
##       bpop[2]    0.2500   10.09   10.07
##       bpop[3]    3.7500    4.40    4.40
##        D[1,1]    0.0900   39.84   39.81
##        D[2,2]    0.0900   60.66   60.48
##        D[3,3]    0.0625   27.56   27.55
##    SIGMA[1,1]    0.0400   13.87   13.80
## 
## Total running time: 7.062 seconds</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/get_rse.html">get_rse</a></span>(output_cost$FIM, output_cost$poped.db)</code></pre></div>
<pre><code>##    bpop[1]    bpop[2]    bpop[3]     D[1,1]     D[2,2]     D[3,3] 
##   8.207404  10.070674   4.399378  39.808012  60.478363  27.549531 
## SIGMA[1,1] 
##  13.800551</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(output_cost$poped.db)</code></pre></div>
<p><img src="intro-poped_files/figure-html/unnamed-chunk-14-1.png" width="576"></p>
</div>
</div>
<div class="footnotes">
<hr><ol><li id="fn1"><p>Tip: to make the optimization run faster use the option <code>parallel = T</code> in the <code>poped_optim</code> command.<a href="#fnref1">&#8617;</a></p></li>
</ol></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#define-a-model">Define a model</a></li>
      <li><a href="#define-an-initial-design-and-design-space">Define an initial design and design space</a></li>
      <li><a href="#the-tasks-to-perform.">The tasks to perform.</a></li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://katalog.uu.se/empinfo/?languageId=1&amp;id=N4-631">Andrew C. Hooker</a>, Sebastian Ueckert, Marco Foracchia, Joakim Nyberg.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
