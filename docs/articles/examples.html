<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Examples • PopED</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Examples">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PopED</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0.9002</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/intro-poped.html">Introduction</a>
</li>
<li>
  <a href="../articles/examples.html">Examples</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/andrewhooker/PopED">
    <span class="fab fa fab fa-github fa-lg"></span>
     
    Source
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Examples</h1>
                        <h4 class="author">Giulia Lestini, Martin Fink and Andrew Hooker</h4>
            
            <h4 class="date">13 September, 2019</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/andrewhooker/PopED/blob/master/vignettes/examples.Rmd"><code>vignettes/examples.Rmd</code></a></small>
      <div class="hidden name"><code>examples.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>In this vignette, we try to highlight PopED features that may be useful. Only code related to specific features we would like to highlight is described here in this vignette. These features (and more) are presented as r-scripts in the “examples” folder in the PopED installation directory. You can view a list of these example files using the commands:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">ex_dir &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"examples"</span>, <span class="dt">package=</span><span class="st">"PopED"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span>(ex_dir)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#&gt;  [1] "ex.1.a.PK.1.comp.oral.md.intro.R"          </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#&gt;  [2] "ex.1.b.PK.1.comp.oral.md.re-parameterize.R"</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#&gt;  [3] "ex.1.c.PK.1.comp.oral.md.ODE.compiled.R"   </span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co">#&gt;  [4] "ex.10.PKPD.HCV.compiled.R"                 </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#&gt;  [5] "ex.11.PK.prior.R"                          </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co">#&gt;  [6] "ex.12.covariate.distributions.R"           </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="co">#&gt;  [7] "ex.13.shrinkage.R"                         </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#&gt;  [8] "ex.14.PK.IOV.R"                            </span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co">#&gt;  [9] "ex.15.full.covariance.matrix.R"            </span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#&gt; [10] "ex.2.a.warfarin.evaluate.R"                </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co">#&gt; [11] "ex.2.b.warfarin.optimize.R"                </span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co">#&gt; [12] "ex.2.c.warfarin.ODE.compiled.R"            </span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co">#&gt; [13] "ex.2.d.warfarin.ED.R"                      </span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#&gt; [14] "ex.2.e.warfarin.Ds.R"                      </span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co">#&gt; [15] "ex.3.a.PKPD.1.comp.oral.md.imax.D-opt.R"   </span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co">#&gt; [16] "ex.3.b.PKPD.1.comp.oral.md.imax.ED-opt.R"  </span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="co">#&gt; [17] "ex.4.PKPD.1.comp.emax.R"                   </span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#&gt; [18] "ex.5.PD.emax.hill.R"                       </span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co">#&gt; [19] "ex.6.PK.1.comp.oral.sd.R"                  </span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="co">#&gt; [20] "ex.7.PK.1.comp.maturation.R"               </span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="co">#&gt; [21] "ex.8.tmdd_qss_one_target_compiled.R"       </span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"><span class="co">#&gt; [22] "ex.9.PK.2.comp.oral.md.ode.compiled.R"     </span></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="co">#&gt; [23] "HCV_ode.c"                                 </span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="co">#&gt; [24] "HCV_ode.o"                                 </span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="co">#&gt; [25] "HCV_ode.so"                                </span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="co">#&gt; [26] "one_comp_oral_CL.c"                        </span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"><span class="co">#&gt; [27] "one_comp_oral_CL.o"                        </span></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="co">#&gt; [28] "one_comp_oral_CL.so"                       </span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="co">#&gt; [29] "tmdd_qss_one_target.c"                     </span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="co">#&gt; [30] "tmdd_qss_one_target.o"                     </span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="co">#&gt; [31] "tmdd_qss_one_target.so"                    </span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"><span class="co">#&gt; [32] "two_comp_oral_CL.c"                        </span></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="co">#&gt; [33] "two_comp_oral_CL.o"                        </span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="co">#&gt; [34] "two_comp_oral_CL.so"</span></a></code></pre></div>
<p>You can then open one of the examples (for example, <code>ex.1.a.PK.1.comp.oral.md.intro.R</code>) using the following code</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">file_name &lt;-<span class="st"> "ex.1.a.PK.1.comp.oral.md.intro.R"</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">ex_file &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span>(<span class="st">"examples"</span>,file_name,<span class="dt">package=</span><span class="st">"PopED"</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/files.html">file.copy</a></span>(ex_file,<span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(),<span class="dt">overwrite =</span> T)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/utils/file.edit.html">file.edit</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>(),file_name))</a></code></pre></div>
<p>The table below provides a check list of features for each of the available examples.</p>
<table class="table">
<thead><tr class="header">
<th>Features</th>
<th>Ex1</th>
<th>Ex2</th>
<th>Ex3</th>
<th>Ex4</th>
<th>Ex5</th>
<th>Ex6</th>
<th>Ex7</th>
<th>Ex8</th>
<th>Ex9</th>
<th>Ex10</th>
<th>Ex11</th>
<th>Ex12</th>
<th>Ex13</th>
<th>Ex14</th>
<th>Ex15</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Analytical model</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="even">
<td>ODE model and doses</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Irregular dosing</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Full cov matrix W</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
</tr>
<tr class="odd">
<td>Inter-occ variability</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="even">
<td>Discrete covariates</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Continuous covariates</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
</tr>
<tr class="even">
<td>Multiple arms</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Multi response models</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Designs differ <br> across responses</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Calculate precision <br>of derived parameters</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Power calculation</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Include previous FIM</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Shrinkage/Bayesian FIM</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Discrete optimization</td>
<td>X</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="even">
<td>Optimization <br> of more-group designs<br> (same response)</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Different optimal<br> sampling times<br> between groups</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>Optimization with constraining <br> sampling times</td>
<td>X</td>
<td>-</td>
<td>X</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>X</td>
<td>-</td>
</tr>
<tr class="odd">
<td>Optimization of subjects <br>per group</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
<div id="analytical-solution-pkpd-model-with-2-groupsarms-setup-only" class="section level1">
<h1 class="hasAnchor">
<a href="#analytical-solution-pkpd-model-with-2-groupsarms-setup-only" class="anchor"></a>Analytical solution PKPD model with 2 groups/arms; setup only</h1>
<p>The full code for this example is available in <code>ex.4.PKPD.1.comp.emax.R</code>.</p>
<p><strong>Define the PKPD model:</strong> Here we define a PKPD mode using analytical equations. The PK is a one compartment model with intravenus bolus administration and linear elimination. The PD is an ordinary Emax model driven by the PK concentrations. The expected output of each measurement (PK or PD) is given in the vector <code>model_switch</code> (see below for details).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(PopED)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">f_pkpdmodel &lt;-<span class="st"> </span><span class="cf">function</span>(model_switch,xt,parameters,poped.db){</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(parameters),{</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">    y=xt</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">    MS &lt;-<span class="st"> </span>model_switch</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    </a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="co"># PK model</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8">    CONC =<span class="st"> </span>DOSE<span class="op">/</span>V<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span>CL<span class="op">/</span>V<span class="op">*</span>xt) </a>
<a class="sourceLine" id="cb3-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb3-10" data-line-number="10">    <span class="co"># PD model</span></a>
<a class="sourceLine" id="cb3-11" data-line-number="11">    EFF =<span class="st"> </span>E0 <span class="op">+</span><span class="st"> </span>CONC<span class="op">*</span>EMAX<span class="op">/</span>(EC50 <span class="op">+</span><span class="st"> </span>CONC)</a>
<a class="sourceLine" id="cb3-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb3-13" data-line-number="13">    y[MS<span class="op">==</span><span class="dv">1</span>] =<span class="st"> </span>CONC[MS<span class="op">==</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb3-14" data-line-number="14">    y[MS<span class="op">==</span><span class="dv">2</span>] =<span class="st"> </span>EFF[MS<span class="op">==</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb3-15" data-line-number="15">    </a>
<a class="sourceLine" id="cb3-16" data-line-number="16">    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="dt">y=</span> y,<span class="dt">poped.db=</span>poped.db))</a>
<a class="sourceLine" id="cb3-17" data-line-number="17">  })</a>
<a class="sourceLine" id="cb3-18" data-line-number="18">}</a></code></pre></div>
<p>The error model also has to accommodate both response models.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">## -- Residual Error function</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">## -- Proportional PK + additive PD</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">f_Err &lt;-<span class="st"> </span><span class="cf">function</span>(model_switch,xt,parameters,epsi,poped.db){</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  returnArgs &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/do.call.html">do.call</a></span>(poped.db<span class="op">$</span>model<span class="op">$</span>ff_pointer,<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(model_switch,xt,parameters,poped.db)) </a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  y &lt;-<span class="st"> </span>returnArgs[[<span class="dv">1</span>]]</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  poped.db &lt;-<span class="st"> </span>returnArgs[[<span class="dv">2</span>]]</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb4-8" data-line-number="8">  MS &lt;-<span class="st"> </span>model_switch</a>
<a class="sourceLine" id="cb4-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb4-10" data-line-number="10">  prop.err &lt;-<span class="st"> </span>y<span class="op">*</span>(<span class="dv">1</span><span class="op">+</span>epsi[,<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb4-11" data-line-number="11">  add.err &lt;-<span class="st"> </span>y<span class="op">+</span>epsi[,<span class="dv">2</span>]</a>
<a class="sourceLine" id="cb4-12" data-line-number="12">  </a>
<a class="sourceLine" id="cb4-13" data-line-number="13">  y[MS<span class="op">==</span><span class="dv">1</span>] =<span class="st"> </span>prop.err[MS<span class="op">==</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb4-14" data-line-number="14">  y[MS<span class="op">==</span><span class="dv">2</span>] =<span class="st"> </span>add.err[MS<span class="op">==</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb4-15" data-line-number="15">  </a>
<a class="sourceLine" id="cb4-16" data-line-number="16">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="dt">y=</span> y,<span class="dt">poped.db =</span>poped.db )) </a>
<a class="sourceLine" id="cb4-17" data-line-number="17">}</a></code></pre></div>
<p>Some of the parameters are assumed to have log-normal distributions in the population.</p>
<p><em>Define design and design space</em></p>
<p>We specify in the <code>poped.db</code> object the vector <code>model_switch</code> in order to assign the sampling times written in the vector <code>xt</code> to the PK (=1) or PD (=2) model.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">poped.db &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="dt">ff_fun=</span>f_pkpdmodel,</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                                  <span class="dt">fError_fun=</span>f_Err,</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">                                  <span class="dt">fg_fun=</span>f_etaToParam,</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">                                  <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.15</span>,<span class="fl">0.015</span>)),</a>
<a class="sourceLine" id="cb5-5" data-line-number="5">                                  <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.5</span>,<span class="dt">V=</span><span class="fl">0.2</span>,<span class="dt">E0=</span><span class="dv">1</span>,<span class="dt">EMAX=</span><span class="dv">1</span>,<span class="dt">EC50=</span><span class="dv">1</span>),  </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                                  <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.09</span>,<span class="dt">V=</span><span class="fl">0.09</span>,<span class="dt">E0=</span><span class="fl">0.04</span>,<span class="dt">EC50=</span><span class="fl">0.09</span>), </a>
<a class="sourceLine" id="cb5-7" data-line-number="7">                                  <span class="dt">groupsize=</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">                                  <span class="dt">m=</span><span class="dv">3</span>,</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">                                  <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">0.33</span>,<span class="fl">0.66</span>,<span class="fl">0.9</span>,<span class="dv">5</span>,<span class="fl">0.1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">5</span>),</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">                                  <span class="dt">minxt=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb5-11" data-line-number="11">                                  <span class="dt">maxxt=</span><span class="dv">5</span>,</a>
<a class="sourceLine" id="cb5-12" data-line-number="12">                                  <span class="dt">bUseGrouped_xt=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb5-13" data-line-number="13">                                  <span class="dt">model_switch=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>),</a>
<a class="sourceLine" id="cb5-14" data-line-number="14">                                  <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">0</span>),<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">1</span>),<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">2</span>)),</a>
<a class="sourceLine" id="cb5-15" data-line-number="15">                                  <span class="dt">maxa=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">10</span>),</a>
<a class="sourceLine" id="cb5-16" data-line-number="16">                                  <span class="dt">mina=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">0</span>))</a></code></pre></div>
<p>The model predictions below show typical PK and PD profiles for three dose groups. The initial design, as shown in the <code>poped.db</code> object, consists of 3 arms with doses of 0, 1, and 2 mg; PK sampling times are 0.33, 0.66, 0.9, and 5 hours/days; PD sampling times are 0.1, 1, 2, and 5 hours/days. With <code>model.names=c("PK","PD")</code> one can name the outputs in the graph.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db,<span class="dt">IPRED=</span><span class="ot">TRUE</span>,<span class="dt">DV=</span><span class="ot">TRUE</span>,<span class="dt">facet_scales=</span><span class="st">"free"</span>,</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">                      <span class="dt">separate.groups=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">                      <span class="dt">model.names=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"PK"</span>,<span class="st">"PD"</span>)) </a></code></pre></div>
<p><img src="examples_files/figure-html/simulate_multi-response_model-1.png" width="700"></p>
</div>
<div id="ode-solution-of-pk-model-and-multiple-dose-dosing-scheme-design-evaluation" class="section level1">
<h1 class="hasAnchor">
<a href="#ode-solution-of-pk-model-and-multiple-dose-dosing-scheme-design-evaluation" class="anchor"></a>ODE solution of PK model and multiple dose dosing scheme; design evaluation</h1>
<p>The full code for this example is available in <code>ex.9.PK.2.comp.oral.md.ode.compiled.R</code>.</p>
<p>In this example, the <code>deSolve</code> library needs to be installed for computing solutions to a system of differential equations. For faster solutions one can use pre-compiled code using the <code>Rcpp</code> library.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(Rcpp)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(deSolve)</a></code></pre></div>
<p><em>Define the system using ODEs</em></p>
<p>Here we define the two compartment model in R using deSolve notation</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">PK.<span class="fl">2.</span>comp.oral.ode &lt;-<span class="st"> </span><span class="cf">function</span>(Time, State, Pars){</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(State, Pars)), {    </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">    dA1 &lt;-<span class="st"> </span><span class="op">-</span>KA<span class="op">*</span>A1 </a>
<a class="sourceLine" id="cb8-4" data-line-number="4">    dA2 &lt;-<span class="st"> </span>KA<span class="op">*</span>A1 <span class="op">+</span><span class="st"> </span>A3<span class="op">*</span><span class="st"> </span>Q<span class="op">/</span>V2 <span class="op">-</span>A2<span class="op">*</span>(CL<span class="op">/</span>V1<span class="op">+</span>Q<span class="op">/</span>V1)</a>
<a class="sourceLine" id="cb8-5" data-line-number="5">    dA3 &lt;-<span class="st"> </span>A2<span class="op">*</span><span class="st"> </span>Q<span class="op">/</span>V1<span class="op">-</span>A3<span class="op">*</span><span class="st"> </span>Q<span class="op">/</span>V2</a>
<a class="sourceLine" id="cb8-6" data-line-number="6">    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(dA1, dA2, dA3)))</a>
<a class="sourceLine" id="cb8-7" data-line-number="7">  })</a>
<a class="sourceLine" id="cb8-8" data-line-number="8">}</a></code></pre></div>
<p>Now we define the initial conditions of the ODE system <code>A_ini</code> with a named vector, in this case all compartments are initialized to zero <code><a href="https://rdrr.io/r/base/c.html">c(A1=0,A2=0,A3=0)</a></code>. The dosing input is defined as a data.frame <code>eventdat</code> referring to the named compartment <code>var = c("A1")</code>, the specified <code>dose_times</code> and <code>value=c(DOSE)</code> dose amounts. Note that the covariates <code>DOSE</code> and the regimen <code>TAU</code> can differ by arm and be optimized (as shown in <code>ex.1.a.PK.1.comp.oral.md.intro.R</code>). For more information see the help pages for <code><a href="https://rdrr.io/pkg/deSolve/man/ode.html">?deSolve::ode</a></code> and <code><a href="https://rdrr.io/pkg/deSolve/man/events.html">?deSolve::events</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">ff.PK.<span class="fl">2.</span>comp.oral.md.ode &lt;-<span class="st"> </span><span class="cf">function</span>(model_switch, xt, parameters, poped.db){</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(parameters),{</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">    A_ini &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">A1=</span><span class="dv">0</span>, <span class="dt">A2=</span><span class="dv">0</span>, <span class="dt">A3=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">    times_xt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(xt)</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">    dose_times =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from=</span><span class="dv">0</span>,<span class="dt">to=</span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(times_xt),<span class="dt">by=</span>TAU)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6">    eventdat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">var =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>), </a>
<a class="sourceLine" id="cb9-7" data-line-number="7">                           <span class="dt">time =</span> dose_times,</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">                           <span class="dt">value =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(DOSE), <span class="dt">method =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"add"</span>))</a>
<a class="sourceLine" id="cb9-9" data-line-number="9">    times &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(times_xt,dose_times))</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb9-11" data-line-number="11">    <span class="co"># Here "PK.2.comp.oral.ode" is equivalent to the pre-compiled version "two_comp_oral_ode_Rcpp".</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">    out &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span>(A_ini, times, PK.<span class="fl">2.</span>comp.oral.ode, parameters,</a>
<a class="sourceLine" id="cb9-13" data-line-number="13">               <span class="dt">events =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">data =</span> eventdat))<span class="co">#atol=1e-13,rtol=1e-13)</span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14">    y =<span class="st"> </span>out[, <span class="st">"A2"</span>]<span class="op">/</span>(V1<span class="op">/</span>Favail)</a>
<a class="sourceLine" id="cb9-15" data-line-number="15">    y=y[<span class="kw"><a href="https://rdrr.io/r/base/match.html">match</a></span>(times_xt,out[,<span class="st">"time"</span>])]</a>
<a class="sourceLine" id="cb9-16" data-line-number="16">    y=<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(y)</a>
<a class="sourceLine" id="cb9-17" data-line-number="17">    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">y=</span>y,<span class="dt">poped.db=</span>poped.db))</a>
<a class="sourceLine" id="cb9-18" data-line-number="18">  })</a>
<a class="sourceLine" id="cb9-19" data-line-number="19">}</a></code></pre></div>
<p>The parameter definition function should match the parameters used in the above two functions.</p>
<p><em>Define design and design space</em></p>
<p>We now create a PopED database. The <code>ff_fun</code> should now point to the function providing the solution of the ODE.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">discrete_a &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cell.html">cell</a></span>(<span class="dv">2</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2"></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">poped.db &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="dt">ff_fun=</span><span class="st">"ff.PK.2.comp.oral.md.ode"</span>,</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">                                  <span class="dt">fError_fun=</span><span class="st">"feps.add.prop"</span>,</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">                                  <span class="dt">fg_fun=</span><span class="st">"fg"</span>,</a>
<a class="sourceLine" id="cb10-6" data-line-number="6">                                  <span class="dt">groupsize=</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb10-7" data-line-number="7">                                  <span class="dt">m=</span><span class="dv">1</span>,      <span class="co">#number of groups</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8">                                  <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">prop=</span><span class="fl">0.1</span><span class="op">^</span><span class="dv">2</span>,<span class="dt">add=</span><span class="fl">0.05</span><span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb10-9" data-line-number="9">                                  <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="dv">10</span>,<span class="dt">V1=</span><span class="dv">100</span>,<span class="dt">KA=</span><span class="dv">1</span>,<span class="dt">Q=</span> <span class="fl">3.0</span>, <span class="dt">V2=</span> <span class="fl">40.0</span>, <span class="dt">Favail=</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb10-10" data-line-number="10">                                  <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.15</span><span class="op">^</span><span class="dv">2</span>,<span class="dt">KA=</span><span class="fl">0.25</span><span class="op">^</span><span class="dv">2</span>),</a>
<a class="sourceLine" id="cb10-11" data-line-number="11">                                  <span class="dt">notfixed_bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb10-12" data-line-number="12">                                  <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dv">48</span>,<span class="dv">50</span>,<span class="dv">55</span>,<span class="dv">65</span>,<span class="dv">70</span>,<span class="dv">85</span>,<span class="dv">90</span>,<span class="dv">120</span>), </a>
<a class="sourceLine" id="cb10-13" data-line-number="13">                                  <span class="dt">minxt=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb10-14" data-line-number="14">                                  <span class="dt">maxxt=</span><span class="dv">144</span>,</a>
<a class="sourceLine" id="cb10-15" data-line-number="15">                                  <span class="dt">discrete_xt =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dv">0</span><span class="op">:</span><span class="dv">144</span>),</a>
<a class="sourceLine" id="cb10-16" data-line-number="16">                                  <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">100</span>,<span class="dt">TAU=</span><span class="dv">24</span>),</a>
<a class="sourceLine" id="cb10-17" data-line-number="17">                                  <span class="dt">maxa=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">1000</span>,<span class="dt">TAU=</span><span class="dv">24</span>),</a>
<a class="sourceLine" id="cb10-18" data-line-number="18">                                  <span class="dt">mina=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">0</span>,<span class="dt">TAU=</span><span class="dv">8</span>),</a>
<a class="sourceLine" id="cb10-19" data-line-number="19">                                  <span class="dt">discrete_a =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">DOSE=</span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">0</span>,<span class="dv">1000</span>,<span class="dt">by=</span><span class="dv">100</span>),<span class="dt">TAU=</span><span class="dv">8</span><span class="op">:</span><span class="dv">24</span>))</a></code></pre></div>
<p><em>Plot intial design (just PRED)</em></p>
<p>We plot the initial design</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db)</a></code></pre></div>
<p><img src="examples_files/figure-html/simulate_ODE_model-1.png" width="700"></p>
<p><em>Faster computations with Rcpp</em></p>
<p>We could also define the system using Rcpp, which will produce compiled code that should run faster (further examples in <code>ex.2.c.warfarin.ODE.compiled.R</code>). First we redefine the ODE system using Rcpp.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html">cppFunction</a></span>(<span class="st">'List two_comp_oral_ode_Rcpp(double Time, NumericVector A, NumericVector Pars) {</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">            int n = A.size();</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">            NumericVector dA(n);</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">            </span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">            double CL = Pars[0];</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="st">            double V1 = Pars[1];</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="st">            double KA = Pars[2];</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="st">            double Q  = Pars[3];</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="st">            double V2 = Pars[4];</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="st">            </span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="st">            dA[0] = -KA*A[0];</span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="st">            dA[1] = KA*A[0] - (CL/V1)*A[1] - Q/V1*A[1] + Q/V2*A[2];</span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="st">            dA[2] = Q/V1*A[1] - Q/V2*A[2];</span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="st">            return List::create(dA);</span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="st">            }'</span>)</a></code></pre></div>
<p>Next we solve this system of ODEs using deSolve.</p>
<p>Finally we create a poped database to use these functions by updating the previously created database.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">poped.db.Rcpp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(poped.db,</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">                                       <span class="dt">ff_fun=</span><span class="st">"ff.PK.2.comp.oral.md.ode.Rcpp"</span>)</a></code></pre></div>
<p><em>Design evaluation</em></p>
<p>We can compare the time for design evaluation with these two methods of describing the same model.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="../reference/tic.html">tic</a></span>(); eval &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db); <span class="kw"><a href="../reference/toc.html">toc</a></span>()</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="co">#&gt; Elapsed time: 2.537 seconds.</span></a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="kw"><a href="../reference/tic.html">tic</a></span>(); eval &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db.Rcpp); <span class="kw"><a href="../reference/toc.html">toc</a></span>()</a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#&gt; Elapsed time: 1.258 seconds.</span></a></code></pre></div>
<p>The difference is noticeable and gets larger for more complex and lengthy ODE models.</p>
</div>
<div id="ode-solution-for-tmdd-model-with-2-outputs-arms-with-either-single-sc-or-iv-dose-and-different-number-of-sampling-times-per-arm" class="section level1">
<h1 class="hasAnchor">
<a href="#ode-solution-for-tmdd-model-with-2-outputs-arms-with-either-single-sc-or-iv-dose-and-different-number-of-sampling-times-per-arm" class="anchor"></a>ODE solution for TMDD model with 2 outputs, arms with either single sc or iv dose, and different number of sampling times per arm</h1>
<p>The full code for this example is available in <code>ex.8.tmdd_qss_one_target_compiled.R</code>.</p>
<p>Compile code using Rcpp for the TMDD model is as follows.</p>
<p>Define the parameters and the distributions of those parameters.</p>
<p>In the function that defines the dosing and derives the ODE solution, the discrete covariate <code>SC_FLAG</code> is used to give the dose either into <code>A1</code> or <code>A2</code>, the sub-cutaneous or the IV compartment.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">tmdd_qss_one_target_model_compiled &lt;-<span class="st"> </span><span class="cf">function</span>(model_switch,xt,parameters,poped.db){</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(parameters),{</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">    y=xt</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb15-5" data-line-number="5">    <span class="co">#The initialization vector for the compartment</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6">    A_ini &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">A1=</span>DOSE<span class="op">*</span>SC_FLAG,</a>
<a class="sourceLine" id="cb15-7" data-line-number="7">               <span class="dt">A2=</span>DOSE<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>SC_FLAG),</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">               <span class="dt">A3=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">               <span class="dt">A4=</span>R0)</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">    </a>
<a class="sourceLine" id="cb15-11" data-line-number="11">    <span class="co">#Set up time points for the ODE</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">    times_xt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(xt)</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">    times &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(times_xt)</a>
<a class="sourceLine" id="cb15-14" data-line-number="14">    times &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,times) <span class="co">## add extra time for start of integration</span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15">    </a>
<a class="sourceLine" id="cb15-16" data-line-number="16">    <span class="co"># solve the ODE</span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17">    out &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span>(A_ini, times, tmdd_qss_one_target_model_ode, parameters)<span class="co">#,atol=1e-13,rtol=1e-13)</span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18">    </a>
<a class="sourceLine" id="cb15-19" data-line-number="19">    </a>
<a class="sourceLine" id="cb15-20" data-line-number="20">    <span class="co"># extract the time points of the observations</span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21">    out =<span class="st"> </span>out[<span class="kw"><a href="https://rdrr.io/r/base/match.html">match</a></span>(times_xt,out[,<span class="st">"time"</span>]),]</a>
<a class="sourceLine" id="cb15-22" data-line-number="22">    </a>
<a class="sourceLine" id="cb15-23" data-line-number="23">    <span class="co"># Match ODE output to measurements</span></a>
<a class="sourceLine" id="cb15-24" data-line-number="24">    RTOT =<span class="st"> </span>out[,<span class="st">"A4"</span>]</a>
<a class="sourceLine" id="cb15-25" data-line-number="25">    CTOT =<span class="st"> </span>out[,<span class="st">"A2"</span>]<span class="op">/</span>V1</a>
<a class="sourceLine" id="cb15-26" data-line-number="26">    CFREE =<span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>((CTOT<span class="op">-</span>RTOT<span class="op">-</span>KSSS)<span class="op">+</span><span class="kw"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>((CTOT<span class="op">-</span>RTOT<span class="op">-</span>KSSS)<span class="op">^</span><span class="dv">2</span><span class="op">+</span><span class="dv">4</span><span class="op">*</span>KSSS<span class="op">*</span>CTOT))</a>
<a class="sourceLine" id="cb15-27" data-line-number="27">    COMPLEX=((RTOT<span class="op">*</span>CFREE)<span class="op">/</span>(KSSS<span class="op">+</span>CFREE))</a>
<a class="sourceLine" id="cb15-28" data-line-number="28">    RFREE=<span class="st"> </span>RTOT<span class="op">-</span>COMPLEX</a>
<a class="sourceLine" id="cb15-29" data-line-number="29">    </a>
<a class="sourceLine" id="cb15-30" data-line-number="30">    y[model_switch<span class="op">==</span><span class="dv">1</span>]=<span class="st"> </span>RTOT[model_switch<span class="op">==</span><span class="dv">1</span>]</a>
<a class="sourceLine" id="cb15-31" data-line-number="31">    y[model_switch<span class="op">==</span><span class="dv">2</span>] =CFREE[model_switch<span class="op">==</span><span class="dv">2</span>]</a>
<a class="sourceLine" id="cb15-32" data-line-number="32">    <span class="co">#y[model_switch==3]=RFREE[model_switch==3]</span></a>
<a class="sourceLine" id="cb15-33" data-line-number="33">    </a>
<a class="sourceLine" id="cb15-34" data-line-number="34">    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="dt">y=</span>y,<span class="dt">poped.db=</span>poped.db))</a>
<a class="sourceLine" id="cb15-35" data-line-number="35">  })</a>
<a class="sourceLine" id="cb15-36" data-line-number="36">}</a></code></pre></div>
<p>Finally we define the residual unexplained variability model.</p>
<p><em>Define the design</em></p>
<p>Two different sub-studies are defined, with different sampling times per arm - in terms of total number of samples and the actual times<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. Due to this difference in numbers and the relatively complicated study design we define the sample times (<code>xt</code>) what each sample time will meansre (<code>model_switch</code>) and which samples should be taken at the same study time (<code>G_xt</code>) as matricies. Here three variables <code>xt</code>, <code>model_switch</code>, and <code>G_xt</code> are matrices with each row representing one arm, and the number of columns is the maximum number of samples (for all endpoints) in any of the arms (i.e., <code><a href="https://rdrr.io/r/base/Extremes.html">max(ni)</a></code>). To be clear about which elements in the matriicies should be considered we specify the number of samples per arm by defining the vector <code>ni</code> in the <code><a href="../reference/create.poped.database.html">create.poped.database()</a></code> function.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">xt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/zeros.html">zeros</a></span>(<span class="dv">6</span>,<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">study_<span class="dv">1</span>_xt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.0417</span>,<span class="fl">0.25</span>,<span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">14</span>,<span class="dv">21</span>,<span class="dv">28</span>,<span class="dv">35</span>,<span class="dv">42</span>,<span class="dv">49</span>,<span class="dv">56</span>),<span class="dv">8</span>),<span class="dt">nrow=</span><span class="dv">4</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">study_<span class="dv">2</span>_xt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.0417</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">14</span>,<span class="dv">21</span>,<span class="dv">28</span>,<span class="dv">56</span>,<span class="dv">63</span>,<span class="dv">70</span>,<span class="dv">77</span>,<span class="dv">84</span>,<span class="dv">91</span>,<span class="dv">98</span>,<span class="dv">105</span>),<span class="dv">4</span>),<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">xt[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">26</span>] &lt;-<span class="st"> </span>study_<span class="dv">1</span>_xt</a>
<a class="sourceLine" id="cb16-5" data-line-number="5">xt[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>,] &lt;-<span class="st"> </span>study_<span class="dv">2</span>_xt</a>
<a class="sourceLine" id="cb16-6" data-line-number="6"></a>
<a class="sourceLine" id="cb16-7" data-line-number="7">model_switch &lt;-<span class="st"> </span><span class="kw"><a href="../reference/zeros.html">zeros</a></span>(<span class="dv">6</span>,<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb16-8" data-line-number="8">model_switch[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9">model_switch[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">14</span><span class="op">:</span><span class="dv">26</span>] &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10">model_switch[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">15</span>] &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11">model_switch[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>,<span class="dv">16</span><span class="op">:</span><span class="dv">30</span>] &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb16-12" data-line-number="12"></a>
<a class="sourceLine" id="cb16-13" data-line-number="13">G_xt &lt;-<span class="st"> </span><span class="kw"><a href="../reference/zeros.html">zeros</a></span>(<span class="dv">6</span>,<span class="dv">30</span>)</a>
<a class="sourceLine" id="cb16-14" data-line-number="14">study_<span class="dv">1</span>_G_xt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span><span class="op">:</span><span class="dv">13</span>),<span class="dv">8</span>),<span class="dt">nrow=</span><span class="dv">4</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-15" data-line-number="15">study_<span class="dv">2</span>_G_xt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">14</span><span class="op">:</span><span class="dv">28</span>),<span class="dv">4</span>),<span class="dt">nrow=</span><span class="dv">2</span>,<span class="dt">byrow=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb16-16" data-line-number="16">G_xt[<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">26</span>] &lt;-<span class="st"> </span>study_<span class="dv">1</span>_G_xt</a>
<a class="sourceLine" id="cb16-17" data-line-number="17">G_xt[<span class="dv">5</span><span class="op">:</span><span class="dv">6</span>,] &lt;-<span class="st"> </span>study_<span class="dv">2</span>_G_xt</a></code></pre></div>
<p>These can then be plugged into the normal <code>poped.db</code> setup.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">poped.db<span class="fl">.2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(<span class="dt">ff_fun=</span>tmdd_qss_one_target_model_compiled,</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">                                    <span class="dt">fError_fun=</span>tmdd_qss_one_target_model_ruv,</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">                                    <span class="dt">fg_fun=</span>sfg,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">                                    <span class="dt">groupsize=</span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">100</span>,<span class="dv">100</span>),</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">                                    <span class="dt">m=</span><span class="dv">6</span>,      <span class="co">#number of groups</span></a>
<a class="sourceLine" id="cb17-6" data-line-number="6">                                    <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.04</span>,<span class="fl">0.0225</span>),</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">                                    <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.3</span>,<span class="dt">V1=</span><span class="dv">3</span>,<span class="dt">Q=</span><span class="fl">0.2</span>,<span class="dt">V2=</span><span class="dv">3</span>,<span class="dt">FAVAIL=</span><span class="fl">0.7</span>,<span class="dt">KA=</span><span class="fl">0.5</span>,<span class="dt">VMAX=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">                                           <span class="dt">KMSS=</span><span class="dv">0</span>,<span class="dt">R0=</span><span class="fl">0.1</span>,<span class="dt">KSSS=</span><span class="fl">0.015</span>,<span class="dt">KDEG=</span><span class="dv">10</span>,<span class="dt">KINT=</span><span class="fl">0.05</span>),</a>
<a class="sourceLine" id="cb17-9" data-line-number="9">                                    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.09</span>,<span class="dt">V1=</span><span class="fl">0.09</span>,<span class="dt">Q=</span><span class="fl">0.04</span>,<span class="dt">V2=</span><span class="fl">0.04</span>,<span class="dt">FAVAIL=</span><span class="fl">0.04</span>,</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">                                        <span class="dt">KA=</span><span class="fl">0.16</span>,<span class="dt">VMAX=</span><span class="dv">0</span>,<span class="dt">KMSS=</span><span class="dv">0</span>,<span class="dt">R0=</span><span class="fl">0.09</span>,<span class="dt">KSSS=</span><span class="fl">0.09</span>,<span class="dt">KDEG=</span><span class="fl">0.04</span>,</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">                                        <span class="dt">KINT=</span><span class="fl">0.04</span>),</a>
<a class="sourceLine" id="cb17-12" data-line-number="12">                                    <span class="dt">notfixed_bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb17-13" data-line-number="13">                                    <span class="dt">notfixed_d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb17-14" data-line-number="14">                                    <span class="dt">xt=</span>xt,</a>
<a class="sourceLine" id="cb17-15" data-line-number="15">                                    <span class="dt">model_switch=</span>model_switch,</a>
<a class="sourceLine" id="cb17-16" data-line-number="16">                                    <span class="dt">ni=</span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(<span class="dv">26</span>,<span class="dv">26</span>,<span class="dv">26</span>,<span class="dv">26</span>,<span class="dv">30</span>,<span class="dv">30</span>),</a>
<a class="sourceLine" id="cb17-17" data-line-number="17">                                    <span class="dt">bUseGrouped_xt=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb17-18" data-line-number="18">                                    <span class="dt">G_xt=</span>G_xt,</a>
<a class="sourceLine" id="cb17-19" data-line-number="19">                                    <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">100</span>, <span class="dt">SC_FLAG=</span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb17-20" data-line-number="20">                                           <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">300</span>, <span class="dt">SC_FLAG=</span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb17-21" data-line-number="21">                                           <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">600</span>, <span class="dt">SC_FLAG=</span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb17-22" data-line-number="22">                                           <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">1000</span>, <span class="dt">SC_FLAG=</span><span class="dv">1</span>),</a>
<a class="sourceLine" id="cb17-23" data-line-number="23">                                           <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">600</span>, <span class="dt">SC_FLAG=</span><span class="dv">0</span>),</a>
<a class="sourceLine" id="cb17-24" data-line-number="24">                                           <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">1000</span>, <span class="dt">SC_FLAG=</span><span class="dv">1</span>)),</a>
<a class="sourceLine" id="cb17-25" data-line-number="25">                                    <span class="dt">discrete_a =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">DOSE=</span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dv">100</span>,<span class="dv">1000</span>,<span class="dt">by=</span><span class="dv">100</span>),</a>
<a class="sourceLine" id="cb17-26" data-line-number="26">                                                      <span class="dt">SC_FLAG=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>)))</a></code></pre></div>
<div id="plot-model-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-model-predictions" class="anchor"></a>Plot model predictions</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db<span class="fl">.2</span>,<span class="dt">facet_scales=</span><span class="st">"free"</span>)</a></code></pre></div>
<p><img src="examples_files/figure-html/simulate_different_dose_regimen-1.png" width="700"></p>
</div>
<div id="design-evaluation" class="section level2">
<h2 class="hasAnchor">
<a href="#design-evaluation" class="anchor"></a>Design evaluation</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">eval_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db<span class="fl">.2</span>);</a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(eval_<span class="dv">2</span><span class="op">$</span>rse)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"><span class="co">#&gt;         CL         V1          Q         V2     FAVAIL         KA </span></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co">#&gt;          2          2          2          3          3          5 </span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="co">#&gt;         R0       KSSS       KDEG       KINT      om_CL      om_V1 </span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6"><span class="co">#&gt;          3          3          3          2         11         12 </span></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co">#&gt;       om_Q      om_V2  om_FAVAIL      om_KA      om_R0    om_KSSS </span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8"><span class="co">#&gt;         22         20         24         19         12         13 </span></a>
<a class="sourceLine" id="cb19-9" data-line-number="9"><span class="co">#&gt;    om_KDEG    om_KINT SIGMA[1,1] SIGMA[2,2] </span></a>
<a class="sourceLine" id="cb19-10" data-line-number="10"><span class="co">#&gt;         20         18          3          3</span></a></code></pre></div>
</div>
</div>
<div id="model-with-continuous-covariates" class="section level1">
<h1 class="hasAnchor">
<a href="#model-with-continuous-covariates" class="anchor"></a>Model with continuous covariates</h1>
<p>The R code for this example is available in <code>ex.12.covariate_distributions.R</code>.</p>
<p>Let’s assume that we have a model with a covariate included in the model description. Here we define a one-compartment PK model that uses allometric scaling with a weight effect on both clearance and volume of distribution.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">mod_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="cf">function</span>(model_switch,xt,parameters,poped.db){</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">  <span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(parameters),{</a>
<a class="sourceLine" id="cb20-3" data-line-number="3">    y=xt</a>
<a class="sourceLine" id="cb20-4" data-line-number="4">    </a>
<a class="sourceLine" id="cb20-5" data-line-number="5">    CL=CL<span class="op">*</span>(WT<span class="op">/</span><span class="dv">70</span>)<span class="op">^</span>(WT_CL)</a>
<a class="sourceLine" id="cb20-6" data-line-number="6">    V=V<span class="op">*</span>(WT<span class="op">/</span><span class="dv">70</span>)<span class="op">^</span>(WT_V)</a>
<a class="sourceLine" id="cb20-7" data-line-number="7">    DOSE=<span class="dv">1000</span><span class="op">*</span>(WT<span class="op">/</span><span class="dv">70</span>)</a>
<a class="sourceLine" id="cb20-8" data-line-number="8">    y =<span class="st"> </span>DOSE<span class="op">/</span>V<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(<span class="op">-</span>CL<span class="op">/</span>V<span class="op">*</span>xt) </a>
<a class="sourceLine" id="cb20-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb20-10" data-line-number="10">    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>( <span class="dt">y=</span> y,<span class="dt">poped.db=</span>poped.db))</a>
<a class="sourceLine" id="cb20-11" data-line-number="11">  })</a>
<a class="sourceLine" id="cb20-12" data-line-number="12">}</a>
<a class="sourceLine" id="cb20-13" data-line-number="13"></a>
<a class="sourceLine" id="cb20-14" data-line-number="14">par_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="cf">function</span>(x,a,bpop,b,bocc){</a>
<a class="sourceLine" id="cb20-15" data-line-number="15">  parameters=<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dt">CL=</span>bpop[<span class="dv">1</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb20-16" data-line-number="16">                <span class="dt">V=</span>bpop[<span class="dv">2</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb20-17" data-line-number="17">                <span class="dt">WT_CL=</span>bpop[<span class="dv">3</span>],</a>
<a class="sourceLine" id="cb20-18" data-line-number="18">                <span class="dt">WT_V=</span>bpop[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb20-19" data-line-number="19">                <span class="dt">WT=</span>a[<span class="dv">1</span>])</a>
<a class="sourceLine" id="cb20-20" data-line-number="20">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>( parameters ) </a>
<a class="sourceLine" id="cb20-21" data-line-number="21">}</a></code></pre></div>
<p>Now we define a design. In this case one group of individuals, where we define the individuals’ typical weight as 70 kg (<code>a=c(WT=70)</code>).</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1">poped_db &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">    <span class="dt">ff_fun=</span>mod_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">    <span class="dt">fg_fun=</span>par_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">    <span class="dt">fError_fun=</span>feps.add.prop,</a>
<a class="sourceLine" id="cb21-6" data-line-number="6">    <span class="dt">groupsize=</span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb21-7" data-line-number="7">    <span class="dt">m=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb21-8" data-line-number="8">    <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.015</span>,<span class="fl">0.0015</span>),</a>
<a class="sourceLine" id="cb21-9" data-line-number="9">    <span class="dt">notfixed_sigma =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb21-10" data-line-number="10">    <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">3.8</span>,<span class="dt">V=</span><span class="dv">20</span>,<span class="dt">WT_CL=</span><span class="fl">0.75</span>,<span class="dt">WT_V=</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb21-11" data-line-number="11">    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.05</span>,<span class="dt">V=</span><span class="fl">0.05</span>), </a>
<a class="sourceLine" id="cb21-12" data-line-number="12">    <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">24</span>),</a>
<a class="sourceLine" id="cb21-13" data-line-number="13">    <span class="dt">minxt=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb21-14" data-line-number="14">    <span class="dt">maxxt=</span><span class="dv">24</span>,</a>
<a class="sourceLine" id="cb21-15" data-line-number="15">    <span class="dt">bUseGrouped_xt=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb21-16" data-line-number="16">    <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">WT=</span><span class="dv">70</span>)</a>
<a class="sourceLine" id="cb21-17" data-line-number="17">  )</a></code></pre></div>
<p>We can create a plot of the model prediction for the typical individual</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped_db)</a></code></pre></div>
<p><img src="examples_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
<p>And evaluate the initial design</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped_db)</a>
<a class="sourceLine" id="cb23-2" data-line-number="2"><span class="co">#&gt; Problems inverting the matrix. Results could be misleading.</span></a>
<a class="sourceLine" id="cb23-3" data-line-number="3"><span class="co">#&gt; Warning:   The following parameters are not estimable:</span></a>
<a class="sourceLine" id="cb23-4" data-line-number="4"><span class="co">#&gt;   WT_CL, WT_V</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5"><span class="co">#&gt;   Is the design adequate to estimate all parameters?</span></a>
<a class="sourceLine" id="cb23-6" data-line-number="6"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb23-7" data-line-number="7"><span class="co">#&gt; [1] -Inf</span></a>
<a class="sourceLine" id="cb23-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb23-9" data-line-number="9"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb23-10" data-line-number="10"><span class="co">#&gt;                    CL          V WT_CL WT_V      om_CL       om_V</span></a>
<a class="sourceLine" id="cb23-11" data-line-number="11"><span class="co">#&gt; CL         65.8889583 -0.7145374     0    0    0.00000    0.00000</span></a>
<a class="sourceLine" id="cb23-12" data-line-number="12"><span class="co">#&gt; V          -0.7145374  2.2798156     0    0    0.00000    0.00000</span></a>
<a class="sourceLine" id="cb23-13" data-line-number="13"><span class="co">#&gt; WT_CL       0.0000000  0.0000000     0    0    0.00000    0.00000</span></a>
<a class="sourceLine" id="cb23-14" data-line-number="14"><span class="co">#&gt; WT_V        0.0000000  0.0000000     0    0    0.00000    0.00000</span></a>
<a class="sourceLine" id="cb23-15" data-line-number="15"><span class="co">#&gt; om_CL       0.0000000  0.0000000     0    0 9052.31524   29.49016</span></a>
<a class="sourceLine" id="cb23-16" data-line-number="16"><span class="co">#&gt; om_V        0.0000000  0.0000000     0    0   29.49016 8316.09464</span></a>
<a class="sourceLine" id="cb23-17" data-line-number="17"><span class="co">#&gt; SIGMA[1,1]  0.0000000  0.0000000     0    0 1424.25450 2483.90024</span></a>
<a class="sourceLine" id="cb23-18" data-line-number="18"><span class="co">#&gt;            SIGMA[1,1]</span></a>
<a class="sourceLine" id="cb23-19" data-line-number="19"><span class="co">#&gt; CL              0.000</span></a>
<a class="sourceLine" id="cb23-20" data-line-number="20"><span class="co">#&gt; V               0.000</span></a>
<a class="sourceLine" id="cb23-21" data-line-number="21"><span class="co">#&gt; WT_CL           0.000</span></a>
<a class="sourceLine" id="cb23-22" data-line-number="22"><span class="co">#&gt; WT_V            0.000</span></a>
<a class="sourceLine" id="cb23-23" data-line-number="23"><span class="co">#&gt; om_CL        1424.255</span></a>
<a class="sourceLine" id="cb23-24" data-line-number="24"><span class="co">#&gt; om_V         2483.900</span></a>
<a class="sourceLine" id="cb23-25" data-line-number="25"><span class="co">#&gt; SIGMA[1,1] 440009.144</span></a>
<a class="sourceLine" id="cb23-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb23-27" data-line-number="27"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb23-28" data-line-number="28"><span class="co">#&gt;         CL          V      WT_CL       WT_V      om_CL       om_V </span></a>
<a class="sourceLine" id="cb23-29" data-line-number="29"><span class="co">#&gt;   3.247502   3.317107         NA         NA  21.026264  21.950179 </span></a>
<a class="sourceLine" id="cb23-30" data-line-number="30"><span class="co">#&gt; SIGMA[1,1] </span></a>
<a class="sourceLine" id="cb23-31" data-line-number="31"><span class="co">#&gt;  10.061292</span></a></code></pre></div>
<p>It is obvious that the covariate parameters can not be estimated according to this design calculation (RSE of bpop[3]=0 and bpop[4]=0). Why is that? Well, the calculation being done is assuming that every individual in the group has the same covariate (to speed up the calculation). This is clearly a poor prediction in this case!</p>
<div id="distribution-of-covariates" class="section level2">
<h2 class="hasAnchor">
<a href="#distribution-of-covariates" class="anchor"></a>Distribution of covariates</h2>
<p>We can improve the computation by assuming a distribution of the covariate (WT) in the individuals in the study. We set <code>groupsize=1</code>, the number of groups to be 50 (<code>m=50</code>) and assume that WT is sampled from a normal distribution with mean=70 and sd=10 (<code>a=as.list(rnorm(50, mean = 70, sd = 10)</code>).</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">poped_db_<span class="dv">2</span> &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">    <span class="dt">ff_fun=</span>mod_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">    <span class="dt">fg_fun=</span>par_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">    <span class="dt">fError_fun=</span>feps.add.prop,</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">    <span class="dt">groupsize=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">    <span class="dt">m=</span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb24-8" data-line-number="8">    <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.015</span>,<span class="fl">0.0015</span>),</a>
<a class="sourceLine" id="cb24-9" data-line-number="9">    <span class="dt">notfixed_sigma =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb24-10" data-line-number="10">    <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">3.8</span>,<span class="dt">V=</span><span class="dv">20</span>,<span class="dt">WT_CL=</span><span class="fl">0.75</span>,<span class="dt">WT_V=</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb24-11" data-line-number="11">    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.05</span>,<span class="dt">V=</span><span class="fl">0.05</span>), </a>
<a class="sourceLine" id="cb24-12" data-line-number="12">    <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">24</span>),</a>
<a class="sourceLine" id="cb24-13" data-line-number="13">    <span class="dt">minxt=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb24-14" data-line-number="14">    <span class="dt">maxxt=</span><span class="dv">24</span>,</a>
<a class="sourceLine" id="cb24-15" data-line-number="15">    <span class="dt">bUseGrouped_xt=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb24-16" data-line-number="16">    <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">50</span>, <span class="dt">mean =</span> <span class="dv">70</span>, <span class="dt">sd =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb24-17" data-line-number="17">  )</a></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1">ev &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped_db_<span class="dv">2</span>) </a>
<a class="sourceLine" id="cb25-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev<span class="op">$</span>ofv,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="co">#&gt; [1] 41.3</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev<span class="op">$</span>rse)</a>
<a class="sourceLine" id="cb25-5" data-line-number="5"><span class="co">#&gt;         CL          V      WT_CL       WT_V      om_CL       om_V </span></a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="co">#&gt;          3          3         36         27         21         22 </span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"><span class="co">#&gt; SIGMA[1,1] </span></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="co">#&gt;         10</span></a></code></pre></div>
<p>Here we see that, given this distribution of weights, the covariate effect parameters (bpop[3] and bpop[4]) would be well estimated.</p>
<p>However, we are only looking at one sample of 50 individuals. Maybe a better approach is to look at the distribution of RSEs over a number of experiments given the expected weight distribution.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">nsim &lt;-<span class="st"> </span><span class="dv">30</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">rse_list &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>()</a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>nsim){</a>
<a class="sourceLine" id="cb26-4" data-line-number="4">  poped_db_tmp &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb26-5" data-line-number="5"><span class="st">    </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb26-6" data-line-number="6">      <span class="dt">ff_fun=</span>mod_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb26-7" data-line-number="7">      <span class="dt">fg_fun=</span>par_<span class="dv">1</span>,</a>
<a class="sourceLine" id="cb26-8" data-line-number="8">      <span class="dt">fError_fun=</span>feps.add.prop,</a>
<a class="sourceLine" id="cb26-9" data-line-number="9">      <span class="dt">groupsize=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb26-10" data-line-number="10">      <span class="dt">m=</span><span class="dv">50</span>,</a>
<a class="sourceLine" id="cb26-11" data-line-number="11">      <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.015</span>,<span class="fl">0.0015</span>),</a>
<a class="sourceLine" id="cb26-12" data-line-number="12">      <span class="dt">notfixed_sigma =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb26-13" data-line-number="13">      <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">3.8</span>,<span class="dt">V=</span><span class="dv">20</span>,<span class="dt">WT_CL=</span><span class="fl">0.75</span>,<span class="dt">WT_V=</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb26-14" data-line-number="14">      <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.05</span>,<span class="dt">V=</span><span class="fl">0.05</span>), </a>
<a class="sourceLine" id="cb26-15" data-line-number="15">      <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">8</span>,<span class="dv">24</span>),</a>
<a class="sourceLine" id="cb26-16" data-line-number="16">      <span class="dt">minxt=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb26-17" data-line-number="17">      <span class="dt">maxxt=</span><span class="dv">24</span>,</a>
<a class="sourceLine" id="cb26-18" data-line-number="18">      <span class="dt">bUseGrouped_xt=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb26-19" data-line-number="19">      <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span>(<span class="dv">50</span>,<span class="dt">mean =</span> <span class="dv">70</span>,<span class="dt">sd=</span><span class="dv">10</span>)))</a>
<a class="sourceLine" id="cb26-20" data-line-number="20">  rse_tmp &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped_db_tmp)<span class="op">$</span>rse</a>
<a class="sourceLine" id="cb26-21" data-line-number="21">  rse_list &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span>(rse_list,rse_tmp)</a>
<a class="sourceLine" id="cb26-22" data-line-number="22">}</a>
<a class="sourceLine" id="cb26-23" data-line-number="23"><span class="kw"><a href="https://rdrr.io/r/base/apply.html">apply</a></span>(rse_list,<span class="dv">2</span>,quantile)</a>
<a class="sourceLine" id="cb26-24" data-line-number="24"><span class="co">#&gt;            CL        V    WT_CL     WT_V    om_CL     om_V SIGMA[1,1]</span></a>
<a class="sourceLine" id="cb26-25" data-line-number="25"><span class="co">#&gt; 0%   3.247616 3.317709 24.55658 18.82725 21.02205 21.94643   10.05667</span></a>
<a class="sourceLine" id="cb26-26" data-line-number="26"><span class="co">#&gt; 25%  3.255458 3.325429 27.90694 21.38893 21.02665 21.95489   10.06588</span></a>
<a class="sourceLine" id="cb26-27" data-line-number="27"><span class="co">#&gt; 50%  3.288969 3.359708 30.51321 23.38975 21.02758 21.95676   10.06755</span></a>
<a class="sourceLine" id="cb26-28" data-line-number="28"><span class="co">#&gt; 75%  3.356314 3.428355 32.95918 25.25363 21.02940 21.95855   10.06999</span></a>
<a class="sourceLine" id="cb26-29" data-line-number="29"><span class="co">#&gt; 100% 3.503839 3.579278 40.07473 30.70397 21.03126 21.96329   10.07453</span></a></code></pre></div>
<p>Note, that the variance of the RSE of the covariate effect is in this case strongly correlated with the variance of the weight distribution (not shown).</p>
</div>
</div>
<div id="model-with-discrete-covariates" class="section level1">
<h1 class="hasAnchor">
<a href="#model-with-discrete-covariates" class="anchor"></a>Model with discrete covariates</h1>
<p>See <code>ex.11.PK.prior.R</code>. This has the covariate <code>isPediatric</code> to distinguish between adults and pediatrics. Alternatively, <code>DOSE</code> and <code>TAU</code> in the first example can be considered as discrete covariates but are not per se estimated but rather optimized.</p>
</div>
<div id="model-with-inter-occasion-variability" class="section level1">
<h1 class="hasAnchor">
<a href="#model-with-inter-occasion-variability" class="anchor"></a>Model with Inter-Occasion Variability</h1>
<p>The full code for this example is available in <code>ex.14.PK.IOV.R</code>.</p>
<p>The IOV is introduced with <code>bocc[x,y]</code> in the parameter definition function as a matrix with the first argument <code>x</code> indicating the index for the IOV variances defined in <code>docc</code> below, and the second argument <code>y</code> denoting the occasion. This is used in the example to derive to different clearance values, i.e., <code>CL_OCC_1</code> and <code>CL_OCC_2</code> (think of some drug-drug interaction).</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">sfg &lt;-<span class="st"> </span><span class="cf">function</span>(x,a,bpop,b,bocc){</a>
<a class="sourceLine" id="cb27-2" data-line-number="2">  parameters=<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dt">CL_OCC_1=</span>bpop[<span class="dv">1</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">1</span>]<span class="op">+</span>bocc[<span class="dv">1</span>,<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb27-3" data-line-number="3">                <span class="dt">CL_OCC_2=</span>bpop[<span class="dv">1</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">1</span>]<span class="op">+</span>bocc[<span class="dv">1</span>,<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb27-4" data-line-number="4">                <span class="dt">V=</span>bpop[<span class="dv">2</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb27-5" data-line-number="5">                <span class="dt">KA=</span>bpop[<span class="dv">3</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">3</span>]),</a>
<a class="sourceLine" id="cb27-6" data-line-number="6">                <span class="dt">DOSE=</span>a[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb27-7" data-line-number="7">                <span class="dt">TAU=</span>a[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb27-8" data-line-number="8">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>( parameters ) </a>
<a class="sourceLine" id="cb27-9" data-line-number="9">}</a></code></pre></div>
<p>These parameters can now be used in the model function to define the change in parameters between the occacions (here with the 7th dose in a one-compartment model with first order absorption).</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/pkg/Rcpp/man/cppFunction.html">cppFunction</a></span>(</a>
<a class="sourceLine" id="cb28-2" data-line-number="2">  <span class="st">'List one_comp_oral_ode(double Time, NumericVector A, NumericVector Pars) {</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="st">   int n = A.size();</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="st">   NumericVector dA(n);</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5"><span class="st">            </span></a>
<a class="sourceLine" id="cb28-6" data-line-number="6"><span class="st">   double CL_OCC_1 = Pars[0];</span></a>
<a class="sourceLine" id="cb28-7" data-line-number="7"><span class="st">   double CL_OCC_2 = Pars[1];</span></a>
<a class="sourceLine" id="cb28-8" data-line-number="8"><span class="st">   double V = Pars[2];</span></a>
<a class="sourceLine" id="cb28-9" data-line-number="9"><span class="st">   double KA = Pars[3];</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10"><span class="st">   double TAU = Pars[4];</span></a>
<a class="sourceLine" id="cb28-11" data-line-number="11"><span class="st">   double N,CL;</span></a>
<a class="sourceLine" id="cb28-12" data-line-number="12"><span class="st">            </span></a>
<a class="sourceLine" id="cb28-13" data-line-number="13"><span class="st">   N = floor(Time/TAU)+1;</span></a>
<a class="sourceLine" id="cb28-14" data-line-number="14"><span class="st">   CL = CL_OCC_1;</span></a>
<a class="sourceLine" id="cb28-15" data-line-number="15"><span class="st">   if(N&gt;6) CL = CL_OCC_2;</span></a>
<a class="sourceLine" id="cb28-16" data-line-number="16"><span class="st">   </span></a>
<a class="sourceLine" id="cb28-17" data-line-number="17"><span class="st">   dA[0] = -KA*A[0];</span></a>
<a class="sourceLine" id="cb28-18" data-line-number="18"><span class="st">   dA[1] = KA*A[0] - (CL/V)*A[1];</span></a>
<a class="sourceLine" id="cb28-19" data-line-number="19"><span class="st">   return List::create(dA);</span></a>
<a class="sourceLine" id="cb28-20" data-line-number="20"><span class="st">   }'</span></a>
<a class="sourceLine" id="cb28-21" data-line-number="21">)</a>
<a class="sourceLine" id="cb28-22" data-line-number="22"></a>
<a class="sourceLine" id="cb28-23" data-line-number="23">ff.ode.rcpp &lt;-<span class="st"> </span><span class="cf">function</span>(model_switch, xt, parameters, poped.db){</a>
<a class="sourceLine" id="cb28-24" data-line-number="24">  <span class="kw"><a href="https://rdrr.io/r/base/with.html">with</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(parameters),{</a>
<a class="sourceLine" id="cb28-25" data-line-number="25">    A_ini &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">A1=</span><span class="dv">0</span>, <span class="dt">A2=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb28-26" data-line-number="26">    times_xt &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/drop.html">drop</a></span>(xt) <span class="co">#xt[,,drop=T] </span></a>
<a class="sourceLine" id="cb28-27" data-line-number="27">    dose_times =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="dt">from=</span><span class="dv">0</span>,<span class="dt">to=</span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(times_xt),<span class="dt">by=</span>TAU)</a>
<a class="sourceLine" id="cb28-28" data-line-number="28">    eventdat &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">var =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>), </a>
<a class="sourceLine" id="cb28-29" data-line-number="29">                           <span class="dt">time =</span> dose_times,</a>
<a class="sourceLine" id="cb28-30" data-line-number="30">                           <span class="dt">value =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(DOSE), <span class="dt">method =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"add"</span>))</a>
<a class="sourceLine" id="cb28-31" data-line-number="31">    times &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(times_xt,dose_times))</a>
<a class="sourceLine" id="cb28-32" data-line-number="32">    out &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/pkg/deSolve/man/ode.html">ode</a></span>(A_ini, times, one_comp_oral_ode, <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(CL_OCC_<span class="dv">1</span>,CL_OCC_<span class="dv">2</span>,V,KA,TAU), </a>
<a class="sourceLine" id="cb28-33" data-line-number="33">               <span class="dt">events =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">data =</span> eventdat))<span class="co">#atol=1e-13,rtol=1e-13)</span></a>
<a class="sourceLine" id="cb28-34" data-line-number="34">    y =<span class="st"> </span>out[, <span class="st">"A2"</span>]<span class="op">/</span>(V)</a>
<a class="sourceLine" id="cb28-35" data-line-number="35">    y=y[<span class="kw"><a href="https://rdrr.io/r/base/match.html">match</a></span>(times_xt,out[,<span class="st">"time"</span>])]</a>
<a class="sourceLine" id="cb28-36" data-line-number="36">    y=<span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(y)</a>
<a class="sourceLine" id="cb28-37" data-line-number="37">    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">y=</span>y,<span class="dt">poped.db=</span>poped.db))</a>
<a class="sourceLine" id="cb28-38" data-line-number="38">  })</a>
<a class="sourceLine" id="cb28-39" data-line-number="39">}</a></code></pre></div>
<p>The within-subject variability variances (<code>docc</code>) are defined in the poped database as a 3-column matrix with one row per IOV-parameter, and the middle column giving the variance values.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">poped.db &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb29-3" data-line-number="3">    <span class="dt">ff_fun=</span>ff.ode.rcpp,</a>
<a class="sourceLine" id="cb29-4" data-line-number="4">    <span class="dt">fError_fun=</span>feps.add.prop,</a>
<a class="sourceLine" id="cb29-5" data-line-number="5">    <span class="dt">fg_fun=</span>sfg,</a>
<a class="sourceLine" id="cb29-6" data-line-number="6">    <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">3.75</span>,<span class="dt">V=</span><span class="fl">72.8</span>,<span class="dt">KA=</span><span class="fl">0.25</span>), </a>
<a class="sourceLine" id="cb29-7" data-line-number="7">    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.25</span><span class="op">^</span><span class="dv">2</span>,<span class="dt">V=</span><span class="fl">0.09</span>,<span class="dt">KA=</span><span class="fl">0.09</span>), </a>
<a class="sourceLine" id="cb29-8" data-line-number="8">    <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.04</span>,<span class="fl">5e-6</span>),</a>
<a class="sourceLine" id="cb29-9" data-line-number="9">    <span class="dt">notfixed_sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb29-10" data-line-number="10">    <span class="dt">docc =</span> <span class="kw"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="fl">0.09</span>,<span class="dv">0</span>),<span class="dt">nrow =</span> <span class="dv">1</span>),</a>
<a class="sourceLine" id="cb29-11" data-line-number="11">    <span class="dt">m=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb29-12" data-line-number="12">    <span class="dt">groupsize=</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb29-13" data-line-number="13">    <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">8</span>,<span class="dv">240</span>,<span class="dv">245</span>),</a>
<a class="sourceLine" id="cb29-14" data-line-number="14">    <span class="dt">minxt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">240</span>,<span class="dv">240</span>),</a>
<a class="sourceLine" id="cb29-15" data-line-number="15">    <span class="dt">maxxt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">10</span>,<span class="dv">248</span>,<span class="dv">248</span>),</a>
<a class="sourceLine" id="cb29-16" data-line-number="16">    <span class="dt">bUseGrouped_xt=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb29-17" data-line-number="17">    <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">20</span>,<span class="dt">TAU=</span><span class="dv">24</span>),<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">40</span>, <span class="dt">TAU=</span><span class="dv">24</span>)),</a>
<a class="sourceLine" id="cb29-18" data-line-number="18">    <span class="dt">maxa=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">200</span>,<span class="dt">TAU=</span><span class="dv">24</span>),</a>
<a class="sourceLine" id="cb29-19" data-line-number="19">    <span class="dt">mina=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">0</span>,<span class="dt">TAU=</span><span class="dv">24</span>)</a>
<a class="sourceLine" id="cb29-20" data-line-number="20">  )</a></code></pre></div>
<div id="create-plot-of-the-population-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#create-plot-of-the-population-predictions" class="anchor"></a>Create plot of the population predictions</h2>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db, <span class="dt">model_num_points =</span> <span class="dv">300</span>)</a></code></pre></div>
<p><img src="examples_files/figure-html/simulate_IOV_without_IIV-1.png" width="700"></p>
</div>
<div id="visualize-the-iov" class="section level2">
<h2 class="hasAnchor">
<a href="#visualize-the-iov" class="anchor"></a>visualize the IOV</h2>
<p>We can visualize the IOV by looking at an example individual. We see the PK profile changes at the 7th dose (red line) due to the change in clearance.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db, <span class="dt">PRED=</span>F,<span class="dt">IPRED=</span>F, </a>
<a class="sourceLine" id="cb31-4" data-line-number="4">                      <span class="dt">separate.groups=</span>T, <span class="dt">model_num_points =</span> <span class="dv">300</span>, </a>
<a class="sourceLine" id="cb31-5" data-line-number="5">                      <span class="dt">groupsize_sim =</span> <span class="dv">1</span>,</a>
<a class="sourceLine" id="cb31-6" data-line-number="6">                      <span class="dt">IPRED.lines =</span> T, <span class="dt">alpha.IPRED.lines=</span><span class="fl">0.6</span>,</a>
<a class="sourceLine" id="cb31-7" data-line-number="7">                      <span class="dt">sample.times =</span> F</a>
<a class="sourceLine" id="cb31-8" data-line-number="8">                      ) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_vline</a></span>(<span class="dt">xintercept =</span> <span class="dv">24</span><span class="op">*</span><span class="dv">6</span>,<span class="dt">color=</span><span class="st">"red"</span>)</a></code></pre></div>
<p><img src="examples_files/figure-html/simulate_IOV_with_IIV-1.png" width="700"></p>
</div>
<div id="evaluate-initial-design" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluate-initial-design" class="anchor"></a>Evaluate initial design</h2>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">ev &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db)</a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev<span class="op">$</span>rse)</a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="co">#&gt;         CL          V         KA      om_CL       om_V      om_KA </span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="co">#&gt;          6          9         11        106         43         63 </span></a>
<a class="sourceLine" id="cb32-5" data-line-number="5"><span class="co">#&gt; D.occ[1,1] </span></a>
<a class="sourceLine" id="cb32-6" data-line-number="6"><span class="co">#&gt;         79</span></a></code></pre></div>
</div>
</div>
<div id="full-omega-matrix" class="section level1">
<h1 class="hasAnchor">
<a href="#full-omega-matrix" class="anchor"></a>Full omega matrix</h1>
<p>The full code for this example is available in <code>ex.15.full.covariance.matrix.R</code>.</p>
<p>The <code>covd</code> object is used for defining the covariances of the IIV variances (off-diagonal elements of the full variance-covariance matrix).</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">poped.db_with &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb33-3" data-line-number="3">    <span class="dt">ff_file=</span><span class="st">"ff"</span>,</a>
<a class="sourceLine" id="cb33-4" data-line-number="4">    <span class="dt">fg_file=</span><span class="st">"sfg"</span>,</a>
<a class="sourceLine" id="cb33-5" data-line-number="5">    <span class="dt">fError_file=</span><span class="st">"feps"</span>,</a>
<a class="sourceLine" id="cb33-6" data-line-number="6">    <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.15</span>, <span class="dt">V=</span><span class="dv">8</span>, <span class="dt">KA=</span><span class="fl">1.0</span>, <span class="dt">Favail=</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb33-7" data-line-number="7">    <span class="dt">notfixed_bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb33-8" data-line-number="8">    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.07</span>, <span class="dt">V=</span><span class="fl">0.02</span>, <span class="dt">KA=</span><span class="fl">0.6</span>), </a>
<a class="sourceLine" id="cb33-9" data-line-number="9">    <span class="dt">covd =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(.<span class="dv">03</span>,.<span class="dv">1</span>,.<span class="dv">09</span>),</a>
<a class="sourceLine" id="cb33-10" data-line-number="10">    <span class="dt">sigma=</span><span class="fl">0.01</span>,</a>
<a class="sourceLine" id="cb33-11" data-line-number="11">    <span class="dt">groupsize=</span><span class="dv">32</span>,</a>
<a class="sourceLine" id="cb33-12" data-line-number="12">    <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">24</span>,<span class="dv">36</span>,<span class="dv">72</span>,<span class="dv">120</span>),</a>
<a class="sourceLine" id="cb33-13" data-line-number="13">    <span class="dt">minxt=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb33-14" data-line-number="14">    <span class="dt">maxxt=</span><span class="dv">120</span>,</a>
<a class="sourceLine" id="cb33-15" data-line-number="15">    <span class="dt">a=</span><span class="dv">70</span></a>
<a class="sourceLine" id="cb33-16" data-line-number="16">  )</a></code></pre></div>
<p>What do the covariances mean?</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">(IIV &lt;-<span class="st"> </span>poped.db_with<span class="op">$</span>parameters<span class="op">$</span>param.pt.val<span class="op">$</span>d)</a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="co">#&gt; [1,] 0.07 0.03 0.10</span></a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="co">#&gt; [2,] 0.03 0.02 0.09</span></a>
<a class="sourceLine" id="cb34-5" data-line-number="5"><span class="co">#&gt; [3,] 0.10 0.09 0.60</span></a>
<a class="sourceLine" id="cb34-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/stats/cor.html">cov2cor</a></span>(IIV)</a>
<a class="sourceLine" id="cb34-7" data-line-number="7"><span class="co">#&gt;           [,1]      [,2]      [,3]</span></a>
<a class="sourceLine" id="cb34-8" data-line-number="8"><span class="co">#&gt; [1,] 1.0000000 0.8017837 0.4879500</span></a>
<a class="sourceLine" id="cb34-9" data-line-number="9"><span class="co">#&gt; [2,] 0.8017837 1.0000000 0.8215838</span></a>
<a class="sourceLine" id="cb34-10" data-line-number="10"><span class="co">#&gt; [3,] 0.4879500 0.8215838 1.0000000</span></a></code></pre></div>
<p>They indicate a correlation of the inter-individual variabilities, here of ca. 0.8 between clearance and volume, as well as between volume and absorption rate.</p>
<div id="create-plot-of-the-model-with-variability" class="section level2">
<h2 class="hasAnchor">
<a href="#create-plot-of-the-model-with-variability" class="anchor"></a>Create plot of the model with variability</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</a>
<a class="sourceLine" id="cb35-2" data-line-number="2">p1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db,<span class="dt">IPRED=</span><span class="ot">TRUE</span>)<span class="op">+</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="dv">0</span>,<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb35-3" data-line-number="3">p2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db_with,<span class="dt">IPRED=</span><span class="ot">TRUE</span>) <span class="op">+</span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/lims.html">ylim</a></span>(<span class="dv">0</span>,<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb35-4" data-line-number="4">gridExtra<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/gridExtra/man/arrangeGrob.html">grid.arrange</a></span>(p1, p2, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p><img src="examples_files/figure-html/simulate_with_cov_matrix-1.png" width="700"></p>
</div>
<div id="evaluate-designs-with-and-without-covariance-matrix" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluate-designs-with-and-without-covariance-matrix" class="anchor"></a>Evaluate designs (with and without covariance matrix)</h2>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">ev1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db)</a>
<a class="sourceLine" id="cb36-2" data-line-number="2">ev2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db_with)</a></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb37-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev1<span class="op">$</span>ofv,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb37-2" data-line-number="2"><span class="co">#&gt; [1] 52.4</span></a>
<a class="sourceLine" id="cb37-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev1<span class="op">$</span>rse,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb37-4" data-line-number="4"><span class="co">#&gt;         CL          V         KA      om_CL       om_V      om_KA </span></a>
<a class="sourceLine" id="cb37-5" data-line-number="5"><span class="co">#&gt;        4.7        2.8       13.9       25.6       30.3       25.8 </span></a>
<a class="sourceLine" id="cb37-6" data-line-number="6"><span class="co">#&gt; SIGMA[1,1] </span></a>
<a class="sourceLine" id="cb37-7" data-line-number="7"><span class="co">#&gt;       11.2</span></a>
<a class="sourceLine" id="cb37-8" data-line-number="8"></a>
<a class="sourceLine" id="cb37-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev2<span class="op">$</span>ofv,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb37-10" data-line-number="10"><span class="co">#&gt; [1] 85.9</span></a>
<a class="sourceLine" id="cb37-11" data-line-number="11"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev2<span class="op">$</span>rse,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb37-12" data-line-number="12"><span class="co">#&gt;         CL          V         KA      om_CL       om_V      om_KA </span></a>
<a class="sourceLine" id="cb37-13" data-line-number="13"><span class="co">#&gt;        4.7        2.8       13.9       25.7       30.5       25.9 </span></a>
<a class="sourceLine" id="cb37-14" data-line-number="14"><span class="co">#&gt;   D_cov[1]   D_cov[2]   D_cov[3] SIGMA[1,1] </span></a>
<a class="sourceLine" id="cb37-15" data-line-number="15"><span class="co">#&gt;       30.8       41.5       30.7       11.2</span></a></code></pre></div>
<p>Note, that the precision of all other parameters is barely affected by including the full covariance matrix. This is likely to be different in practice with much more ill-conditioned numerical problems.</p>
</div>
<div id="evaluate-the-same-designs-with-full-fim-instead-of-reduced" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluate-the-same-designs-with-full-fim-instead-of-reduced" class="anchor"></a>Evaluate the same designs with full FIM (instead of reduced)</h2>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">ev1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db, <span class="dt">fim.calc.type=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb38-2" data-line-number="2">ev2 &lt;-<span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db_with, <span class="dt">fim.calc.type=</span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb38-3" data-line-number="3"></a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev1<span class="op">$</span>ofv,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb38-5" data-line-number="5"><span class="co">#&gt; [1] 55.5</span></a>
<a class="sourceLine" id="cb38-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev1<span class="op">$</span>rse,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb38-7" data-line-number="7"><span class="co">#&gt;         CL          V         KA      om_CL       om_V      om_KA </span></a>
<a class="sourceLine" id="cb38-8" data-line-number="8"><span class="co">#&gt;        3.6        2.6        4.8       26.3       30.9       26.5 </span></a>
<a class="sourceLine" id="cb38-9" data-line-number="9"><span class="co">#&gt; SIGMA[1,1] </span></a>
<a class="sourceLine" id="cb38-10" data-line-number="10"><span class="co">#&gt;       12.4</span></a>
<a class="sourceLine" id="cb38-11" data-line-number="11"></a>
<a class="sourceLine" id="cb38-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev2<span class="op">$</span>ofv,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb38-13" data-line-number="13"><span class="co">#&gt; [1] 88.2</span></a>
<a class="sourceLine" id="cb38-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(ev2<span class="op">$</span>rse,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb38-15" data-line-number="15"><span class="co">#&gt;         CL          V         KA      om_CL       om_V      om_KA </span></a>
<a class="sourceLine" id="cb38-16" data-line-number="16"><span class="co">#&gt;        3.8        1.8        4.8       26.5       30.9       26.1 </span></a>
<a class="sourceLine" id="cb38-17" data-line-number="17"><span class="co">#&gt;   D_cov[1]   D_cov[2]   D_cov[3] SIGMA[1,1] </span></a>
<a class="sourceLine" id="cb38-18" data-line-number="18"><span class="co">#&gt;       31.0       41.7       31.1       12.3</span></a></code></pre></div>
</div>
</div>
<div id="include-a-prior-fim-compute-power-to-identify-a-parameter" class="section level1">
<h1 class="hasAnchor">
<a href="#include-a-prior-fim-compute-power-to-identify-a-parameter" class="anchor"></a>Include a prior FIM, compute power to identify a parameter</h1>
<p>In this example you will learn how to incorporate prior knowledge to your current study. First the FIM obtained from an experiment in adulta is stored. Then this FIM is added to the current experiment in children. The full code for this example is available in <code>ex.11.PK.prior.R</code>.</p>
<p>We define here the parameters for one compartment first order absorption model. Of note, <code>isPediatric = x[1]</code> is the flag to switch between adults and pediatrics, and <code>bpop[5]=pedCL</code> is the factor to multiply the adult clearance <code>bpop[3]</code> to obtain the pediatric one.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1"><span class="co">## -- parameter definition function </span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="co">## -- names match parameters in function ff</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="co">## -- note, covariate on clearance for pediatrics (using isPediatric x[1])</span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4">sfg &lt;-<span class="st"> </span><span class="cf">function</span>(x,a,bpop,b,bocc){</a>
<a class="sourceLine" id="cb39-5" data-line-number="5">  parameters=<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( </a>
<a class="sourceLine" id="cb39-6" data-line-number="6">    <span class="dt">V=</span>bpop[<span class="dv">1</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">1</span>]),</a>
<a class="sourceLine" id="cb39-7" data-line-number="7">    <span class="dt">KA=</span>bpop[<span class="dv">2</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">2</span>]),</a>
<a class="sourceLine" id="cb39-8" data-line-number="8">    <span class="dt">CL=</span>bpop[<span class="dv">3</span>]<span class="op">*</span><span class="kw"><a href="https://rdrr.io/r/base/Log.html">exp</a></span>(b[<span class="dv">3</span>])<span class="op">*</span>bpop[<span class="dv">5</span>]<span class="op">^</span>x[<span class="dv">1</span>], <span class="co"># add covariate for pediatrics</span></a>
<a class="sourceLine" id="cb39-9" data-line-number="9">    <span class="dt">Favail=</span>bpop[<span class="dv">4</span>],</a>
<a class="sourceLine" id="cb39-10" data-line-number="10">    <span class="dt">isPediatric =</span> x[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb39-11" data-line-number="11">    <span class="dt">DOSE=</span>a[<span class="dv">1</span>],</a>
<a class="sourceLine" id="cb39-12" data-line-number="12">    <span class="dt">TAU=</span>a[<span class="dv">2</span>])</a>
<a class="sourceLine" id="cb39-13" data-line-number="13">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>( parameters ) </a>
<a class="sourceLine" id="cb39-14" data-line-number="14">}</a></code></pre></div>
<p>Define design and design space for adults (Two arms, 5 time points, <code>isPediatric = 0</code>). As we want to pool the results, we also have to provide here the <code>pedCL</code> parameter.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">poped.db &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb40-3" data-line-number="3">    <span class="dt">ff_fun=</span><span class="st">"ff"</span>,</a>
<a class="sourceLine" id="cb40-4" data-line-number="4">    <span class="dt">fg_fun=</span><span class="st">"sfg"</span>,</a>
<a class="sourceLine" id="cb40-5" data-line-number="5">    <span class="dt">fError_fun=</span><span class="st">"feps"</span>,</a>
<a class="sourceLine" id="cb40-6" data-line-number="6">    <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">V=</span><span class="fl">72.8</span>,<span class="dt">KA=</span><span class="fl">0.25</span>,<span class="dt">CL=</span><span class="fl">3.75</span>,<span class="dt">Favail=</span><span class="fl">0.9</span>,<span class="dt">pedCL=</span><span class="fl">0.8</span>), </a>
<a class="sourceLine" id="cb40-7" data-line-number="7">    <span class="dt">notfixed_bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb40-8" data-line-number="8">    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">V=</span><span class="fl">0.09</span>,<span class="dt">KA=</span><span class="fl">0.09</span>,<span class="dt">CL=</span><span class="fl">0.25</span><span class="op">^</span><span class="dv">2</span>), </a>
<a class="sourceLine" id="cb40-9" data-line-number="9">    <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.04</span>,<span class="fl">5e-6</span>),</a>
<a class="sourceLine" id="cb40-10" data-line-number="10">    <span class="dt">notfixed_sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb40-11" data-line-number="11">    <span class="dt">m=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb40-12" data-line-number="12">    <span class="dt">groupsize=</span><span class="dv">20</span>,</a>
<a class="sourceLine" id="cb40-13" data-line-number="13">    <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dv">1</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">240</span>,<span class="dv">245</span>),</a>
<a class="sourceLine" id="cb40-14" data-line-number="14">    <span class="dt">bUseGrouped_xt=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb40-15" data-line-number="15">    <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">20</span>,<span class="dt">TAU=</span><span class="dv">24</span>),<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">40</span>, <span class="dt">TAU=</span><span class="dv">24</span>)),</a>
<a class="sourceLine" id="cb40-16" data-line-number="16">    <span class="dt">x=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">isPediatric =</span> <span class="dv">0</span>)</a>
<a class="sourceLine" id="cb40-17" data-line-number="17">  )</a></code></pre></div>
<p>Create plot of model without variability</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db, <span class="dt">model_num_points =</span> <span class="dv">300</span>)</a></code></pre></div>
<p><img src="examples_files/figure-html/simulate_adult-1.png" width="700"></p>
<p>To store the FIM from the adult design we evaluate the initial design</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1">(<span class="dt">outAdult =</span> <span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db))</a>
<a class="sourceLine" id="cb42-2" data-line-number="2"><span class="co">#&gt; Problems inverting the matrix. Results could be misleading.</span></a>
<a class="sourceLine" id="cb42-3" data-line-number="3"><span class="co">#&gt; Warning:   The following parameters are not estimable:</span></a>
<a class="sourceLine" id="cb42-4" data-line-number="4"><span class="co">#&gt;   pedCL</span></a>
<a class="sourceLine" id="cb42-5" data-line-number="5"><span class="co">#&gt;   Is the design adequate to estimate all parameters?</span></a>
<a class="sourceLine" id="cb42-6" data-line-number="6"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb42-7" data-line-number="7"><span class="co">#&gt; [1] -Inf</span></a>
<a class="sourceLine" id="cb42-8" data-line-number="8"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb42-9" data-line-number="9"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb42-10" data-line-number="10"><span class="co">#&gt;                 V          KA          CL pedCL         om_V        om_KA</span></a>
<a class="sourceLine" id="cb42-11" data-line-number="11"><span class="co">#&gt; V      0.05854391   -6.815269 -0.01531146     0    0.0000000   0.00000000</span></a>
<a class="sourceLine" id="cb42-12" data-line-number="12"><span class="co">#&gt; KA    -6.81526942 2963.426688 -1.32113719     0    0.0000000   0.00000000</span></a>
<a class="sourceLine" id="cb42-13" data-line-number="13"><span class="co">#&gt; CL    -0.01531146   -1.321137 37.50597895     0    0.0000000   0.00000000</span></a>
<a class="sourceLine" id="cb42-14" data-line-number="14"><span class="co">#&gt; pedCL  0.00000000    0.000000  0.00000000     0    0.0000000   0.00000000</span></a>
<a class="sourceLine" id="cb42-15" data-line-number="15"><span class="co">#&gt; om_V   0.00000000    0.000000  0.00000000     0 1203.3695137 192.31775149</span></a>
<a class="sourceLine" id="cb42-16" data-line-number="16"><span class="co">#&gt; om_KA  0.00000000    0.000000  0.00000000     0  192.3177515 428.81459138</span></a>
<a class="sourceLine" id="cb42-17" data-line-number="17"><span class="co">#&gt; om_CL  0.00000000    0.000000  0.00000000     0    0.2184104   0.01919009</span></a>
<a class="sourceLine" id="cb42-18" data-line-number="18"><span class="co">#&gt;              om_CL</span></a>
<a class="sourceLine" id="cb42-19" data-line-number="19"><span class="co">#&gt; V     0.000000e+00</span></a>
<a class="sourceLine" id="cb42-20" data-line-number="20"><span class="co">#&gt; KA    0.000000e+00</span></a>
<a class="sourceLine" id="cb42-21" data-line-number="21"><span class="co">#&gt; CL    0.000000e+00</span></a>
<a class="sourceLine" id="cb42-22" data-line-number="22"><span class="co">#&gt; pedCL 0.000000e+00</span></a>
<a class="sourceLine" id="cb42-23" data-line-number="23"><span class="co">#&gt; om_V  2.184104e-01</span></a>
<a class="sourceLine" id="cb42-24" data-line-number="24"><span class="co">#&gt; om_KA 1.919009e-02</span></a>
<a class="sourceLine" id="cb42-25" data-line-number="25"><span class="co">#&gt; om_CL 3.477252e+03</span></a>
<a class="sourceLine" id="cb42-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb42-27" data-line-number="27"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb42-28" data-line-number="28"><span class="co">#&gt;         V        KA        CL     pedCL      om_V     om_KA     om_CL </span></a>
<a class="sourceLine" id="cb42-29" data-line-number="29"><span class="co">#&gt;  6.634931  8.587203  4.354792        NA 33.243601 55.689432 27.133255</span></a></code></pre></div>
<p>It is obvious that we cannot estimate the pediatric covariate from adult data only; hence the warning message. You can also note the zeros in the 4th column and 4th row of the FIM indicating that <code>pedCL</code> cannot be estimated from the adult data.</p>
<p>We can evaluate the adult design without warning, by setting the <code>pedCL</code> parameter to be fixed (i.e., not estimated):</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1"><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(<span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(poped.db, <span class="dt">notfixed_bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>)))</a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb43-3" data-line-number="3"><span class="co">#&gt; [1] 29.70233</span></a>
<a class="sourceLine" id="cb43-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb43-5" data-line-number="5"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb43-6" data-line-number="6"><span class="co">#&gt;                 V          KA          CL         om_V        om_KA</span></a>
<a class="sourceLine" id="cb43-7" data-line-number="7"><span class="co">#&gt; V      0.05854391   -6.815269 -0.01531146    0.0000000   0.00000000</span></a>
<a class="sourceLine" id="cb43-8" data-line-number="8"><span class="co">#&gt; KA    -6.81526942 2963.426688 -1.32113719    0.0000000   0.00000000</span></a>
<a class="sourceLine" id="cb43-9" data-line-number="9"><span class="co">#&gt; CL    -0.01531146   -1.321137 37.50597895    0.0000000   0.00000000</span></a>
<a class="sourceLine" id="cb43-10" data-line-number="10"><span class="co">#&gt; om_V   0.00000000    0.000000  0.00000000 1203.3695137 192.31775149</span></a>
<a class="sourceLine" id="cb43-11" data-line-number="11"><span class="co">#&gt; om_KA  0.00000000    0.000000  0.00000000  192.3177515 428.81459138</span></a>
<a class="sourceLine" id="cb43-12" data-line-number="12"><span class="co">#&gt; om_CL  0.00000000    0.000000  0.00000000    0.2184104   0.01919009</span></a>
<a class="sourceLine" id="cb43-13" data-line-number="13"><span class="co">#&gt;              om_CL</span></a>
<a class="sourceLine" id="cb43-14" data-line-number="14"><span class="co">#&gt; V     0.000000e+00</span></a>
<a class="sourceLine" id="cb43-15" data-line-number="15"><span class="co">#&gt; KA    0.000000e+00</span></a>
<a class="sourceLine" id="cb43-16" data-line-number="16"><span class="co">#&gt; CL    0.000000e+00</span></a>
<a class="sourceLine" id="cb43-17" data-line-number="17"><span class="co">#&gt; om_V  2.184104e-01</span></a>
<a class="sourceLine" id="cb43-18" data-line-number="18"><span class="co">#&gt; om_KA 1.919009e-02</span></a>
<a class="sourceLine" id="cb43-19" data-line-number="19"><span class="co">#&gt; om_CL 3.477252e+03</span></a>
<a class="sourceLine" id="cb43-20" data-line-number="20"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb43-21" data-line-number="21"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb43-22" data-line-number="22"><span class="co">#&gt;         V        KA        CL      om_V     om_KA     om_CL </span></a>
<a class="sourceLine" id="cb43-23" data-line-number="23"><span class="co">#&gt;  6.634931  8.587203  4.354792 33.243601 55.689432 27.133255</span></a></code></pre></div>
<p>One obtains good estimates for all parameters for adults (&lt;60% RSE for all).</p>
<p>For pediatrics the covariate <code>isPediatric = 1</code>. We define one arm, 4 time points only</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb44-1" data-line-number="1">poped.db.ped &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb44-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb44-3" data-line-number="3">    <span class="dt">ff_fun=</span><span class="st">"ff"</span>,</a>
<a class="sourceLine" id="cb44-4" data-line-number="4">    <span class="dt">fg_fun=</span><span class="st">"sfg"</span>,</a>
<a class="sourceLine" id="cb44-5" data-line-number="5">    <span class="dt">fError_fun=</span><span class="st">"feps"</span>,</a>
<a class="sourceLine" id="cb44-6" data-line-number="6">    <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">V=</span><span class="fl">72.8</span>,<span class="dt">KA=</span><span class="fl">0.25</span>,<span class="dt">CL=</span><span class="fl">3.75</span>,<span class="dt">Favail=</span><span class="fl">0.9</span>,<span class="dt">pedCL=</span><span class="fl">0.8</span>), </a>
<a class="sourceLine" id="cb44-7" data-line-number="7">    <span class="dt">notfixed_bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>),</a>
<a class="sourceLine" id="cb44-8" data-line-number="8">    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">V=</span><span class="fl">0.09</span>,<span class="dt">KA=</span><span class="fl">0.09</span>,<span class="dt">CL=</span><span class="fl">0.25</span><span class="op">^</span><span class="dv">2</span>), </a>
<a class="sourceLine" id="cb44-9" data-line-number="9">    <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.04</span>,<span class="fl">5e-6</span>),</a>
<a class="sourceLine" id="cb44-10" data-line-number="10">    <span class="dt">notfixed_sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb44-11" data-line-number="11">    <span class="dt">m=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb44-12" data-line-number="12">    <span class="dt">groupsize=</span><span class="dv">6</span>,</a>
<a class="sourceLine" id="cb44-13" data-line-number="13">    <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">240</span>),</a>
<a class="sourceLine" id="cb44-14" data-line-number="14">    <span class="dt">bUseGrouped_xt=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb44-15" data-line-number="15">    <span class="dt">a=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">DOSE=</span><span class="dv">40</span>,<span class="dt">TAU=</span><span class="dv">24</span>)),</a>
<a class="sourceLine" id="cb44-16" data-line-number="16">    <span class="dt">x=</span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">isPediatric =</span> <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb44-17" data-line-number="17">  )</a></code></pre></div>
<p>Create plot of the pediatric model without variability</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1"><span class="kw"><a href="../reference/plot_model_prediction.html">plot_model_prediction</a></span>(poped.db.ped, <span class="dt">model_num_points =</span> <span class="dv">300</span>)</a></code></pre></div>
<p><img src="examples_files/figure-html/simulate_pediatrics-1.png" width="700"></p>
<p>Evaluate the design of the pediatrics study alone.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1"><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db.ped)</a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="co">#&gt; Problems inverting the matrix. Results could be misleading.</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb46-4" data-line-number="4"><span class="co">#&gt; [1] -Inf</span></a>
<a class="sourceLine" id="cb46-5" data-line-number="5"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb46-6" data-line-number="6"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb46-7" data-line-number="7"><span class="co">#&gt;                  V         KA          CL        pedCL        om_V</span></a>
<a class="sourceLine" id="cb46-8" data-line-number="8"><span class="co">#&gt; V      0.007766643  -1.395981 -0.01126202  -0.05279073   0.0000000</span></a>
<a class="sourceLine" id="cb46-9" data-line-number="9"><span class="co">#&gt; KA    -1.395980934 422.458209 -2.14666933 -10.06251250   0.0000000</span></a>
<a class="sourceLine" id="cb46-10" data-line-number="10"><span class="co">#&gt; CL    -0.011262023  -2.146669  5.09936874  23.90329099   0.0000000</span></a>
<a class="sourceLine" id="cb46-11" data-line-number="11"><span class="co">#&gt; pedCL -0.052790734 -10.062512 23.90329099 112.04667652   0.0000000</span></a>
<a class="sourceLine" id="cb46-12" data-line-number="12"><span class="co">#&gt; om_V   0.000000000   0.000000  0.00000000   0.00000000 141.1922923</span></a>
<a class="sourceLine" id="cb46-13" data-line-number="13"><span class="co">#&gt; om_KA  0.000000000   0.000000  0.00000000   0.00000000  53.7923483</span></a>
<a class="sourceLine" id="cb46-14" data-line-number="14"><span class="co">#&gt; om_CL  0.000000000   0.000000  0.00000000   0.00000000   0.7877291</span></a>
<a class="sourceLine" id="cb46-15" data-line-number="15"><span class="co">#&gt;            om_KA       om_CL</span></a>
<a class="sourceLine" id="cb46-16" data-line-number="16"><span class="co">#&gt; V      0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb46-17" data-line-number="17"><span class="co">#&gt; KA     0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb46-18" data-line-number="18"><span class="co">#&gt; CL     0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb46-19" data-line-number="19"><span class="co">#&gt; pedCL  0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb46-20" data-line-number="20"><span class="co">#&gt; om_V  53.7923483   0.7877291</span></a>
<a class="sourceLine" id="cb46-21" data-line-number="21"><span class="co">#&gt; om_KA 58.0960085   0.3375139</span></a>
<a class="sourceLine" id="cb46-22" data-line-number="22"><span class="co">#&gt; om_CL  0.3375139 428.5254900</span></a>
<a class="sourceLine" id="cb46-23" data-line-number="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb46-24" data-line-number="24"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb46-25" data-line-number="25"><span class="co">#&gt;           V          KA          CL       pedCL        om_V       om_KA </span></a>
<a class="sourceLine" id="cb46-26" data-line-number="26"><span class="co">#&gt;  24.7208804  30.8495322   0.5200823  11.4275854 116.2309452 181.1977846 </span></a>
<a class="sourceLine" id="cb46-27" data-line-number="27"><span class="co">#&gt;       om_CL </span></a>
<a class="sourceLine" id="cb46-28" data-line-number="28"><span class="co">#&gt;  77.2918849</span></a></code></pre></div>
<p>Clearly the design has problems on its own.</p>
<p>We can add the prior information from the adult study and evaluate that design (i.e., pooling adult and pediatric data).</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb47-1" data-line-number="1">poped.db.all &lt;-<span class="st"> </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb47-2" data-line-number="2">  poped.db.ped,</a>
<a class="sourceLine" id="cb47-3" data-line-number="3">  <span class="dt">prior_fim =</span> outAdult<span class="op">$</span>fim</a>
<a class="sourceLine" id="cb47-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb47-5" data-line-number="5"></a>
<a class="sourceLine" id="cb47-6" data-line-number="6">(out.all &lt;-<span class="st"> </span><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db.all))</a>
<a class="sourceLine" id="cb47-7" data-line-number="7"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb47-8" data-line-number="8"><span class="co">#&gt; [1] 34.96368</span></a>
<a class="sourceLine" id="cb47-9" data-line-number="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb47-10" data-line-number="10"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb47-11" data-line-number="11"><span class="co">#&gt;                  V         KA          CL        pedCL        om_V</span></a>
<a class="sourceLine" id="cb47-12" data-line-number="12"><span class="co">#&gt; V      0.007766643  -1.395981 -0.01126202  -0.05279073   0.0000000</span></a>
<a class="sourceLine" id="cb47-13" data-line-number="13"><span class="co">#&gt; KA    -1.395980934 422.458209 -2.14666933 -10.06251250   0.0000000</span></a>
<a class="sourceLine" id="cb47-14" data-line-number="14"><span class="co">#&gt; CL    -0.011262023  -2.146669  5.09936874  23.90329099   0.0000000</span></a>
<a class="sourceLine" id="cb47-15" data-line-number="15"><span class="co">#&gt; pedCL -0.052790734 -10.062512 23.90329099 112.04667652   0.0000000</span></a>
<a class="sourceLine" id="cb47-16" data-line-number="16"><span class="co">#&gt; om_V   0.000000000   0.000000  0.00000000   0.00000000 141.1922923</span></a>
<a class="sourceLine" id="cb47-17" data-line-number="17"><span class="co">#&gt; om_KA  0.000000000   0.000000  0.00000000   0.00000000  53.7923483</span></a>
<a class="sourceLine" id="cb47-18" data-line-number="18"><span class="co">#&gt; om_CL  0.000000000   0.000000  0.00000000   0.00000000   0.7877291</span></a>
<a class="sourceLine" id="cb47-19" data-line-number="19"><span class="co">#&gt;            om_KA       om_CL</span></a>
<a class="sourceLine" id="cb47-20" data-line-number="20"><span class="co">#&gt; V      0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb47-21" data-line-number="21"><span class="co">#&gt; KA     0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb47-22" data-line-number="22"><span class="co">#&gt; CL     0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb47-23" data-line-number="23"><span class="co">#&gt; pedCL  0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb47-24" data-line-number="24"><span class="co">#&gt; om_V  53.7923483   0.7877291</span></a>
<a class="sourceLine" id="cb47-25" data-line-number="25"><span class="co">#&gt; om_KA 58.0960085   0.3375139</span></a>
<a class="sourceLine" id="cb47-26" data-line-number="26"><span class="co">#&gt; om_CL  0.3375139 428.5254900</span></a>
<a class="sourceLine" id="cb47-27" data-line-number="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb47-28" data-line-number="28"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb47-29" data-line-number="29"><span class="co">#&gt;         V        KA        CL     pedCL      om_V     om_KA     om_CL </span></a>
<a class="sourceLine" id="cb47-30" data-line-number="30"><span class="co">#&gt;  6.381388  8.222819  4.354761 12.591940 31.808871 52.858399 25.601551</span></a></code></pre></div>
<p>Clearly, the pooled data leads to much higher precision in parameter estimates compared to either study separately.</p>
<p>One can also obtain the power for estimating the pediatric difference in clearance (power in estimating bpop[5] as different from 1).</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1"><span class="kw"><a href="../reference/evaluate_power.html">evaluate_power</a></span>(poped.db.all, <span class="dt">bpop_idx=</span><span class="dv">5</span>, <span class="dt">h0=</span><span class="dv">1</span>, <span class="dt">out=</span>out.all)</a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb48-3" data-line-number="3"><span class="co">#&gt; [1] 34.96368</span></a>
<a class="sourceLine" id="cb48-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb48-5" data-line-number="5"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb48-6" data-line-number="6"><span class="co">#&gt;                  V         KA          CL        pedCL        om_V</span></a>
<a class="sourceLine" id="cb48-7" data-line-number="7"><span class="co">#&gt; V      0.007766643  -1.395981 -0.01126202  -0.05279073   0.0000000</span></a>
<a class="sourceLine" id="cb48-8" data-line-number="8"><span class="co">#&gt; KA    -1.395980934 422.458209 -2.14666933 -10.06251250   0.0000000</span></a>
<a class="sourceLine" id="cb48-9" data-line-number="9"><span class="co">#&gt; CL    -0.011262023  -2.146669  5.09936874  23.90329099   0.0000000</span></a>
<a class="sourceLine" id="cb48-10" data-line-number="10"><span class="co">#&gt; pedCL -0.052790734 -10.062512 23.90329099 112.04667652   0.0000000</span></a>
<a class="sourceLine" id="cb48-11" data-line-number="11"><span class="co">#&gt; om_V   0.000000000   0.000000  0.00000000   0.00000000 141.1922923</span></a>
<a class="sourceLine" id="cb48-12" data-line-number="12"><span class="co">#&gt; om_KA  0.000000000   0.000000  0.00000000   0.00000000  53.7923483</span></a>
<a class="sourceLine" id="cb48-13" data-line-number="13"><span class="co">#&gt; om_CL  0.000000000   0.000000  0.00000000   0.00000000   0.7877291</span></a>
<a class="sourceLine" id="cb48-14" data-line-number="14"><span class="co">#&gt;            om_KA       om_CL</span></a>
<a class="sourceLine" id="cb48-15" data-line-number="15"><span class="co">#&gt; V      0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb48-16" data-line-number="16"><span class="co">#&gt; KA     0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb48-17" data-line-number="17"><span class="co">#&gt; CL     0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb48-18" data-line-number="18"><span class="co">#&gt; pedCL  0.0000000   0.0000000</span></a>
<a class="sourceLine" id="cb48-19" data-line-number="19"><span class="co">#&gt; om_V  53.7923483   0.7877291</span></a>
<a class="sourceLine" id="cb48-20" data-line-number="20"><span class="co">#&gt; om_KA 58.0960085   0.3375139</span></a>
<a class="sourceLine" id="cb48-21" data-line-number="21"><span class="co">#&gt; om_CL  0.3375139 428.5254900</span></a>
<a class="sourceLine" id="cb48-22" data-line-number="22"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb48-23" data-line-number="23"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb48-24" data-line-number="24"><span class="co">#&gt;         V        KA        CL     pedCL      om_V     om_KA     om_CL </span></a>
<a class="sourceLine" id="cb48-25" data-line-number="25"><span class="co">#&gt;  6.381388  8.222819  4.354761 12.591940 31.808871 52.858399 25.601551 </span></a>
<a class="sourceLine" id="cb48-26" data-line-number="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb48-27" data-line-number="27"><span class="co">#&gt; $power</span></a>
<a class="sourceLine" id="cb48-28" data-line-number="28"><span class="co">#&gt;       Value      RSE power_pred power_want need_rse min_N_tot</span></a>
<a class="sourceLine" id="cb48-29" data-line-number="29"><span class="co">#&gt; pedCL   0.8 12.59194   51.01851         80 8.923519        14</span></a></code></pre></div>
<p>We see that to clearly distinguish this parameter that one would need 14 children in the pediatric study (for 80% power at <span class="math inline">\(\alpha=0.05\)</span>).</p>
</div>
<div id="design-evaluation-including-uncertainty-in-the-model-parameters-robust-design" class="section level1">
<h1 class="hasAnchor">
<a href="#design-evaluation-including-uncertainty-in-the-model-parameters-robust-design" class="anchor"></a>Design evaluation including uncertainty in the model parameters (robust design)</h1>
<p>In this example the aim is to evaluate a design incorporating uncertainty around parameter values in the model. The full code for this example is available in <code>ex.2.d.warfarin.ED.R</code>. This illustration is one of the Warfarin examples from software comparison in: Nyberg et al.<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<div id="define-the-model-parameters-for-use-in-poped-db" class="section level2">
<h2 class="hasAnchor">
<a href="#define-the-model-parameters-for-use-in-poped-db" class="anchor"></a>Define the model parameters for use in poped.db</h2>
<p>Adding 10% uncertainty to all fixed effects (not Favail)</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb49-1" data-line-number="1">bpop_vals &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.15</span>, <span class="dt">V=</span><span class="dv">8</span>, <span class="dt">KA=</span><span class="fl">1.0</span>, <span class="dt">Favail=</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb49-2" data-line-number="2">bpop_vals_ed &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb49-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="kw"><a href="../reference/ones.html">ones</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(bpop_vals),<span class="dv">1</span>)<span class="op">*</span><span class="dv">4</span>, <span class="co"># log-normal distribution</span></a>
<a class="sourceLine" id="cb49-4" data-line-number="4">        bpop_vals,</a>
<a class="sourceLine" id="cb49-5" data-line-number="5">        <span class="kw"><a href="../reference/ones.html">ones</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(bpop_vals),<span class="dv">1</span>)<span class="op">*</span>(bpop_vals<span class="op">*</span><span class="fl">0.1</span>)<span class="op">^</span><span class="dv">2</span>) <span class="co"># 10% of bpop value</span></a>
<a class="sourceLine" id="cb49-6" data-line-number="6">bpop_vals_ed[<span class="st">"Favail"</span>,] &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>)</a>
<a class="sourceLine" id="cb49-7" data-line-number="7">bpop_vals_ed</a>
<a class="sourceLine" id="cb49-8" data-line-number="8"><span class="co">#&gt;          bpop_vals         </span></a>
<a class="sourceLine" id="cb49-9" data-line-number="9"><span class="co">#&gt; CL     4      0.15 0.000225</span></a>
<a class="sourceLine" id="cb49-10" data-line-number="10"><span class="co">#&gt; V      4      8.00 0.640000</span></a>
<a class="sourceLine" id="cb49-11" data-line-number="11"><span class="co">#&gt; KA     4      1.00 0.010000</span></a>
<a class="sourceLine" id="cb49-12" data-line-number="12"><span class="co">#&gt; Favail 0      1.00 0.000000</span></a></code></pre></div>
</div>
<div id="define-initial-design-and-design-space" class="section level2">
<h2 class="hasAnchor">
<a href="#define-initial-design-and-design-space" class="anchor"></a>Define initial design and design space</h2>
<p>Now <code>bpop_vals_ed</code> is a matrix and not only a vector and we can define the <code>ED_samp_size=20</code> either here…</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">poped.db &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb50-3" data-line-number="3">    <span class="dt">ff_fun=</span>ff,</a>
<a class="sourceLine" id="cb50-4" data-line-number="4">    <span class="dt">fg_fun=</span>sfg,</a>
<a class="sourceLine" id="cb50-5" data-line-number="5">    <span class="dt">fError_fun=</span>feps.add.prop,</a>
<a class="sourceLine" id="cb50-6" data-line-number="6">    <span class="dt">bpop=</span>bpop_vals_ed, </a>
<a class="sourceLine" id="cb50-7" data-line-number="7">    <span class="dt">notfixed_bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb50-8" data-line-number="8">    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.07</span>, <span class="dt">V=</span><span class="fl">0.02</span>, <span class="dt">KA=</span><span class="fl">0.6</span>), </a>
<a class="sourceLine" id="cb50-9" data-line-number="9">    <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.01</span>,<span class="fl">0.25</span>),</a>
<a class="sourceLine" id="cb50-10" data-line-number="10">    <span class="dt">groupsize=</span><span class="dv">32</span>,</a>
<a class="sourceLine" id="cb50-11" data-line-number="11">    <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">24</span>,<span class="dv">36</span>,<span class="dv">72</span>,<span class="dv">120</span>),</a>
<a class="sourceLine" id="cb50-12" data-line-number="12">    <span class="dt">minxt=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb50-13" data-line-number="13">    <span class="dt">maxxt=</span><span class="dv">120</span>,</a>
<a class="sourceLine" id="cb50-14" data-line-number="14">    <span class="dt">a=</span><span class="dv">70</span>,</a>
<a class="sourceLine" id="cb50-15" data-line-number="15">    <span class="dt">mina=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb50-16" data-line-number="16">    <span class="dt">maxa=</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb50-17" data-line-number="17">    <span class="dt">ED_samp_size=</span><span class="dv">20</span>)</a></code></pre></div>
</div>
<div id="design-evaluation-1" class="section level2">
<h2 class="hasAnchor">
<a href="#design-evaluation-1" class="anchor"></a>Design evaluation</h2>
<p>Or provide the <code>ED_samp_size</code> as a parameter.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1"><span class="kw"><a href="../reference/tic.html">tic</a></span>();<span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db,<span class="dt">d_switch=</span><span class="ot">FALSE</span>,<span class="dt">ED_samp_size=</span><span class="dv">20</span>); <span class="kw"><a href="../reference/toc.html">toc</a></span>()</a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb51-3" data-line-number="3"><span class="co">#&gt; [1] 55.42076</span></a>
<a class="sourceLine" id="cb51-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb51-5" data-line-number="5"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb51-6" data-line-number="6"><span class="co">#&gt;                     CL         V        KA        om_CL        om_V</span></a>
<a class="sourceLine" id="cb51-7" data-line-number="7"><span class="co">#&gt; CL         17713.44930 21.210742 10.451964 0.000000e+00     0.00000</span></a>
<a class="sourceLine" id="cb51-8" data-line-number="8"><span class="co">#&gt; V             21.21074 17.860885 -3.480569 0.000000e+00     0.00000</span></a>
<a class="sourceLine" id="cb51-9" data-line-number="9"><span class="co">#&gt; KA            10.45196 -3.480569 51.242952 0.000000e+00     0.00000</span></a>
<a class="sourceLine" id="cb51-10" data-line-number="10"><span class="co">#&gt; om_CL          0.00000  0.000000  0.000000 2.320990e+03    10.71187</span></a>
<a class="sourceLine" id="cb51-11" data-line-number="11"><span class="co">#&gt; om_V           0.00000  0.000000  0.000000 1.071187e+01 19061.59132</span></a>
<a class="sourceLine" id="cb51-12" data-line-number="12"><span class="co">#&gt; om_KA          0.00000  0.000000  0.000000 3.807884e-02    11.75517</span></a>
<a class="sourceLine" id="cb51-13" data-line-number="13"><span class="co">#&gt; SIGMA[1,1]     0.00000  0.000000  0.000000 7.320334e+02  9672.68773</span></a>
<a class="sourceLine" id="cb51-14" data-line-number="14"><span class="co">#&gt; SIGMA[2,2]     0.00000  0.000000  0.000000 9.051174e+01   265.14648</span></a>
<a class="sourceLine" id="cb51-15" data-line-number="15"><span class="co">#&gt;                  om_KA   SIGMA[1,1]  SIGMA[2,2]</span></a>
<a class="sourceLine" id="cb51-16" data-line-number="16"><span class="co">#&gt; CL          0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb51-17" data-line-number="17"><span class="co">#&gt; V           0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb51-18" data-line-number="18"><span class="co">#&gt; KA          0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb51-19" data-line-number="19"><span class="co">#&gt; om_CL       0.03807884    732.03340   90.511740</span></a>
<a class="sourceLine" id="cb51-20" data-line-number="20"><span class="co">#&gt; om_V       11.75516710   9672.68773  265.146481</span></a>
<a class="sourceLine" id="cb51-21" data-line-number="21"><span class="co">#&gt; om_KA      38.84140423     65.04261    2.943614</span></a>
<a class="sourceLine" id="cb51-22" data-line-number="22"><span class="co">#&gt; SIGMA[1,1] 65.04260578 194973.92321 6607.416102</span></a>
<a class="sourceLine" id="cb51-23" data-line-number="23"><span class="co">#&gt; SIGMA[2,2]  2.94361425   6607.41610  476.686765</span></a>
<a class="sourceLine" id="cb51-24" data-line-number="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb51-25" data-line-number="25"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb51-26" data-line-number="26"><span class="co">#&gt;         CL          V         KA      om_CL       om_V      om_KA </span></a>
<a class="sourceLine" id="cb51-27" data-line-number="27"><span class="co">#&gt;   5.013232   2.979795  14.064619  29.780300  36.697104  26.752106 </span></a>
<a class="sourceLine" id="cb51-28" data-line-number="28"><span class="co">#&gt; SIGMA[1,1] SIGMA[2,2] </span></a>
<a class="sourceLine" id="cb51-29" data-line-number="29"><span class="co">#&gt;  31.409635  25.263587</span></a>
<a class="sourceLine" id="cb51-30" data-line-number="30"><span class="co">#&gt; Elapsed time: 0.134 seconds.</span></a></code></pre></div>
<p>We can see that the result, based on MC sampling, is somewhat variable with so few samples.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1"><span class="kw"><a href="../reference/tic.html">tic</a></span>();<span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db,<span class="dt">d_switch=</span><span class="ot">FALSE</span>,<span class="dt">ED_samp_size=</span><span class="dv">20</span>); <span class="kw"><a href="../reference/toc.html">toc</a></span>()</a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb52-3" data-line-number="3"><span class="co">#&gt; [1] 55.42078</span></a>
<a class="sourceLine" id="cb52-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb52-5" data-line-number="5"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb52-6" data-line-number="6"><span class="co">#&gt;                     CL         V        KA        om_CL        om_V</span></a>
<a class="sourceLine" id="cb52-7" data-line-number="7"><span class="co">#&gt; CL         17672.75468 21.130255 10.405970 0.000000e+00     0.00000</span></a>
<a class="sourceLine" id="cb52-8" data-line-number="8"><span class="co">#&gt; V             21.13026 17.894558 -3.516747 0.000000e+00     0.00000</span></a>
<a class="sourceLine" id="cb52-9" data-line-number="9"><span class="co">#&gt; KA            10.40597 -3.516747 51.694233 0.000000e+00     0.00000</span></a>
<a class="sourceLine" id="cb52-10" data-line-number="10"><span class="co">#&gt; om_CL          0.00000  0.000000  0.000000 2.319884e+03    10.78713</span></a>
<a class="sourceLine" id="cb52-11" data-line-number="11"><span class="co">#&gt; om_V           0.00000  0.000000  0.000000 1.078713e+01 19018.13238</span></a>
<a class="sourceLine" id="cb52-12" data-line-number="12"><span class="co">#&gt; om_KA          0.00000  0.000000  0.000000 3.853264e-02    11.78994</span></a>
<a class="sourceLine" id="cb52-13" data-line-number="13"><span class="co">#&gt; SIGMA[1,1]     0.00000  0.000000  0.000000 7.328174e+02  9681.57549</span></a>
<a class="sourceLine" id="cb52-14" data-line-number="14"><span class="co">#&gt; SIGMA[2,2]     0.00000  0.000000  0.000000 9.055880e+01   265.71956</span></a>
<a class="sourceLine" id="cb52-15" data-line-number="15"><span class="co">#&gt;                  om_KA   SIGMA[1,1]  SIGMA[2,2]</span></a>
<a class="sourceLine" id="cb52-16" data-line-number="16"><span class="co">#&gt; CL          0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb52-17" data-line-number="17"><span class="co">#&gt; V           0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb52-18" data-line-number="18"><span class="co">#&gt; KA          0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb52-19" data-line-number="19"><span class="co">#&gt; om_CL       0.03853264    732.81743   90.558799</span></a>
<a class="sourceLine" id="cb52-20" data-line-number="20"><span class="co">#&gt; om_V       11.78993840   9681.57549  265.719560</span></a>
<a class="sourceLine" id="cb52-21" data-line-number="21"><span class="co">#&gt; om_KA      38.84172366     64.80749    2.949141</span></a>
<a class="sourceLine" id="cb52-22" data-line-number="22"><span class="co">#&gt; SIGMA[1,1] 64.80749211 194334.51693 6610.678081</span></a>
<a class="sourceLine" id="cb52-23" data-line-number="23"><span class="co">#&gt; SIGMA[2,2]  2.94914132   6610.67808  477.620655</span></a>
<a class="sourceLine" id="cb52-24" data-line-number="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb52-25" data-line-number="25"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb52-26" data-line-number="26"><span class="co">#&gt;         CL          V         KA      om_CL       om_V      om_KA </span></a>
<a class="sourceLine" id="cb52-27" data-line-number="27"><span class="co">#&gt;   5.018969   2.977176  14.004024  29.787319  36.743075  26.751992 </span></a>
<a class="sourceLine" id="cb52-28" data-line-number="28"><span class="co">#&gt; SIGMA[1,1] SIGMA[2,2] </span></a>
<a class="sourceLine" id="cb52-29" data-line-number="29"><span class="co">#&gt;  31.496437  25.265033</span></a>
<a class="sourceLine" id="cb52-30" data-line-number="30"><span class="co">#&gt; Elapsed time: 0.133 seconds.</span></a></code></pre></div>
</div>
</div>
<div id="design-evaluation-for-a-subset-of-model-parameters-of-interest-ds-optimality" class="section level1">
<h1 class="hasAnchor">
<a href="#design-evaluation-for-a-subset-of-model-parameters-of-interest-ds-optimality" class="anchor"></a>Design evaluation for a subset of model parameters of interest (Ds optimality)</h1>
<p>Ds-optimality is a criterion that can be used if one is interested in estimating a subset “s” of the model parameters as precisely as possible. The full code for this example is available in <code>ex.2.e.warfarin.Ds.R</code>.</p>
<div id="define-initial-design-and-design-space-1" class="section level2">
<h2 class="hasAnchor">
<a href="#define-initial-design-and-design-space-1" class="anchor"></a>Define initial design and design space</h2>
<p>For Ds optimality we add the <code>ds_index</code> option to the create.poped.database function to indicate whether a paramter is interesting (=1) or not (=0). Moreover, we need to set the <code>ofv_calc_type</code> to 6 for computing the Ds optimality criterion, as it is set to 4 by default (for computing the log of the determiant of FIM). More details are available by running the command <code><a href="../reference/create.poped.database.html">?create.poped.database</a></code>.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1">poped.db &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb53-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/create.poped.database.html">create.poped.database</a></span>(</a>
<a class="sourceLine" id="cb53-3" data-line-number="3">    <span class="dt">ff_fun=</span>ff,</a>
<a class="sourceLine" id="cb53-4" data-line-number="4">    <span class="dt">fg_fun=</span>sfg,</a>
<a class="sourceLine" id="cb53-5" data-line-number="5">    <span class="dt">fError_fun=</span>feps.add.prop,</a>
<a class="sourceLine" id="cb53-6" data-line-number="6">    <span class="dt">bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.15</span>, <span class="dt">V=</span><span class="dv">8</span>, <span class="dt">KA=</span><span class="fl">1.0</span>, <span class="dt">Favail=</span><span class="dv">1</span>), </a>
<a class="sourceLine" id="cb53-7" data-line-number="7">    <span class="dt">notfixed_bpop=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>),</a>
<a class="sourceLine" id="cb53-8" data-line-number="8">    <span class="dt">d=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dt">CL=</span><span class="fl">0.07</span>, <span class="dt">V=</span><span class="fl">0.02</span>, <span class="dt">KA=</span><span class="fl">0.6</span>), </a>
<a class="sourceLine" id="cb53-9" data-line-number="9">    <span class="dt">sigma=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.01</span>,<span class="fl">0.25</span>),</a>
<a class="sourceLine" id="cb53-10" data-line-number="10">    <span class="dt">groupsize=</span><span class="dv">32</span>,</a>
<a class="sourceLine" id="cb53-11" data-line-number="11">    <span class="dt">xt=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>( <span class="fl">0.5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">24</span>,<span class="dv">36</span>,<span class="dv">72</span>,<span class="dv">120</span>),</a>
<a class="sourceLine" id="cb53-12" data-line-number="12">    <span class="dt">minxt=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb53-13" data-line-number="13">    <span class="dt">maxxt=</span><span class="dv">120</span>,</a>
<a class="sourceLine" id="cb53-14" data-line-number="14">    <span class="dt">a=</span><span class="dv">70</span>,</a>
<a class="sourceLine" id="cb53-15" data-line-number="15">    <span class="dt">mina=</span><span class="dv">0</span>,</a>
<a class="sourceLine" id="cb53-16" data-line-number="16">    <span class="dt">maxa=</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb53-17" data-line-number="17">    <span class="dt">ds_index=</span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="co"># size is number_of_non_fixed_parameters</span></a>
<a class="sourceLine" id="cb53-18" data-line-number="18">    <span class="dt">ofv_calc_type=</span><span class="dv">6</span>) <span class="co"># Ds OFV calculation</span></a></code></pre></div>
</div>
<div id="design-evaluation-2" class="section level2">
<h2 class="hasAnchor">
<a href="#design-evaluation-2" class="anchor"></a>Design evaluation</h2>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1"><span class="kw"><a href="../reference/evaluate_design.html">evaluate_design</a></span>(poped.db)</a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="co">#&gt; $ofv</span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="co">#&gt; [1] 14534520</span></a>
<a class="sourceLine" id="cb54-4" data-line-number="4"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb54-5" data-line-number="5"><span class="co">#&gt; $fim</span></a>
<a class="sourceLine" id="cb54-6" data-line-number="6"><span class="co">#&gt;                     CL         V        KA        om_CL         om_V</span></a>
<a class="sourceLine" id="cb54-7" data-line-number="7"><span class="co">#&gt; CL         17141.83891 20.838375 10.011000 0.000000e+00     0.000000</span></a>
<a class="sourceLine" id="cb54-8" data-line-number="8"><span class="co">#&gt; V             20.83837 17.268051 -3.423641 0.000000e+00     0.000000</span></a>
<a class="sourceLine" id="cb54-9" data-line-number="9"><span class="co">#&gt; KA            10.01100 -3.423641 49.864697 0.000000e+00     0.000000</span></a>
<a class="sourceLine" id="cb54-10" data-line-number="10"><span class="co">#&gt; om_CL          0.00000  0.000000  0.000000 2.324341e+03     9.770352</span></a>
<a class="sourceLine" id="cb54-11" data-line-number="11"><span class="co">#&gt; om_V           0.00000  0.000000  0.000000 9.770352e+00 19083.877564</span></a>
<a class="sourceLine" id="cb54-12" data-line-number="12"><span class="co">#&gt; om_KA          0.00000  0.000000  0.000000 3.523364e-02    11.721317</span></a>
<a class="sourceLine" id="cb54-13" data-line-number="13"><span class="co">#&gt; SIGMA[1,1]     0.00000  0.000000  0.000000 7.268410e+02  9656.158553</span></a>
<a class="sourceLine" id="cb54-14" data-line-number="14"><span class="co">#&gt; SIGMA[2,2]     0.00000  0.000000  0.000000 9.062739e+01   266.487127</span></a>
<a class="sourceLine" id="cb54-15" data-line-number="15"><span class="co">#&gt;                  om_KA   SIGMA[1,1]  SIGMA[2,2]</span></a>
<a class="sourceLine" id="cb54-16" data-line-number="16"><span class="co">#&gt; CL          0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb54-17" data-line-number="17"><span class="co">#&gt; V           0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb54-18" data-line-number="18"><span class="co">#&gt; KA          0.00000000      0.00000    0.000000</span></a>
<a class="sourceLine" id="cb54-19" data-line-number="19"><span class="co">#&gt; om_CL       0.03523364    726.84097   90.627386</span></a>
<a class="sourceLine" id="cb54-20" data-line-number="20"><span class="co">#&gt; om_V       11.72131703   9656.15855  266.487127</span></a>
<a class="sourceLine" id="cb54-21" data-line-number="21"><span class="co">#&gt; om_KA      38.85137516     64.78096    2.947285</span></a>
<a class="sourceLine" id="cb54-22" data-line-number="22"><span class="co">#&gt; SIGMA[1,1] 64.78095548 192840.20092 6659.569867</span></a>
<a class="sourceLine" id="cb54-23" data-line-number="23"><span class="co">#&gt; SIGMA[2,2]  2.94728469   6659.56987  475.500111</span></a>
<a class="sourceLine" id="cb54-24" data-line-number="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb54-25" data-line-number="25"><span class="co">#&gt; $rse</span></a>
<a class="sourceLine" id="cb54-26" data-line-number="26"><span class="co">#&gt;         CL          V         KA      om_CL       om_V      om_KA </span></a>
<a class="sourceLine" id="cb54-27" data-line-number="27"><span class="co">#&gt;   5.096246   3.031164  14.260384  29.761226  36.681388  26.748640 </span></a>
<a class="sourceLine" id="cb54-28" data-line-number="28"><span class="co">#&gt; SIGMA[1,1] SIGMA[2,2] </span></a>
<a class="sourceLine" id="cb54-29" data-line-number="29"><span class="co">#&gt;  32.011719  25.637971</span></a></code></pre></div>
</div>
</div>
<div id="shrinkage" class="section level1">
<h1 class="hasAnchor">
<a href="#shrinkage" class="anchor"></a>Shrinkage</h1>
<p>The full code for this example is available in “ex.13.shrinkage.R”.</p>
<p><img src="examples_files/figure-html/unnamed-chunk-56-1.png" width="700"></p>
<p>To evaluate the estimation quality of the individual random effects in the model (the b’s) we use the function <code><a href="../reference/shrinkage.html">shrinkage()</a></code>.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb55-1" data-line-number="1"><span class="kw"><a href="../reference/shrinkage.html">shrinkage</a></span>(poped.db)</a>
<a class="sourceLine" id="cb55-2" data-line-number="2"><span class="co">#&gt; # A tibble: 3 x 5</span></a>
<a class="sourceLine" id="cb55-3" data-line-number="3"><span class="co">#&gt;   `d[1]` `d[2]` `d[3]` type       group</span></a>
<a class="sourceLine" id="cb55-4" data-line-number="4"><span class="co">#&gt;    &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;</span></a>
<a class="sourceLine" id="cb55-5" data-line-number="5"><span class="co">#&gt; 1  0.504  0.367  0.424 shrink_var grp_1</span></a>
<a class="sourceLine" id="cb55-6" data-line-number="6"><span class="co">#&gt; 2  0.295  0.205  0.241 shrink_sd  grp_1</span></a>
<a class="sourceLine" id="cb55-7" data-line-number="7"><span class="co">#&gt; 3  0.710  0.303  0.206 se         grp_1</span></a></code></pre></div>
<p>The output shows us the expected shrinkage on the variance scale (<span class="math inline">\(shrink_{var}=1-var(b_j)/D(j,j)\)</span>) and on the standard deviation scale (<span class="math inline">\(shrink_{sd}=1-sd(b_j)/sqrt(D(j,j))\)</span>), as well as the standard errors of the <span class="math inline">\(b_j\)</span> estimates.</p>
</div>
<div id="further-examples-to-be-implemented" class="section level1">
<h1 class="hasAnchor">
<a href="#further-examples-to-be-implemented" class="anchor"></a>Further examples (to be implemented)</h1>
<ul>
<li>Espresso design</li>
<li>Handling BLQ data<br>
</li>
<li>Irregular dosing more complex: e.g. switching between s.c. and i.v. within one arm.</li>
<li>Constraining the optimization to different allowed sampling times for each group<br>
</li>
<li>Constraining the optimization to different allowed sampling times for each response</li>
<li>Keep some sampling time fixed (they will be automatically part of the optimal design protocol)<br>
</li>
<li>Handling derived outputs<br>
</li>
<li>Symbolic differentiation</li>
</ul>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Study 1 and 2 from table 2 in: Gibiansky, L., Gibiansky, E., &amp; Bauer, R. (2012). Comparison of Nonmem 7.2 estimation methods and parallel processing efficiency on a target-mediated drug disposition model. Journal of Pharmacokinetics and Pharmacodynamics, 39(1), 17–35. <a href="https://doi.org/10.1007/s10928-011-9228-y" class="uri">https://doi.org/10.1007/s10928-011-9228-y</a><a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Nyberg, J., Bazzoli, C., Ogungbenro, K., Aliev, A., Leonov, S., Duffull, S., Hooker, A.C. and Mentré, F. (2014). Methods and software tools for design evaluation for population pharmacokinetics-pharmacodynamics studies. British Journal of Clinical Pharmacology, 79(1), 1–32. <a href="https://doi.org/10.1111/bcp.12352" class="uri">https://doi.org/10.1111/bcp.12352</a><a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#analytical-solution-pkpd-model-with-2-groupsarms-setup-only">Analytical solution PKPD model with 2 groups/arms; setup only</a></li>
      <li><a href="#ode-solution-of-pk-model-and-multiple-dose-dosing-scheme-design-evaluation">ODE solution of PK model and multiple dose dosing scheme; design evaluation</a></li>
      <li>
<a href="#ode-solution-for-tmdd-model-with-2-outputs-arms-with-either-single-sc-or-iv-dose-and-different-number-of-sampling-times-per-arm">ODE solution for TMDD model with 2 outputs, arms with either single sc or iv dose, and different number of sampling times per arm</a><ul class="nav nav-pills nav-stacked">
<li><a href="#plot-model-predictions">Plot model predictions</a></li>
      <li><a href="#design-evaluation">Design evaluation</a></li>
      </ul>
</li>
      <li>
<a href="#model-with-continuous-covariates">Model with continuous covariates</a><ul class="nav nav-pills nav-stacked">
<li><a href="#distribution-of-covariates">Distribution of covariates</a></li>
      </ul>
</li>
      <li><a href="#model-with-discrete-covariates">Model with discrete covariates</a></li>
      <li>
<a href="#model-with-inter-occasion-variability">Model with Inter-Occasion Variability</a><ul class="nav nav-pills nav-stacked">
<li><a href="#create-plot-of-the-population-predictions">Create plot of the population predictions</a></li>
      <li><a href="#visualize-the-iov">visualize the IOV</a></li>
      <li><a href="#evaluate-initial-design">Evaluate initial design</a></li>
      </ul>
</li>
      <li>
<a href="#full-omega-matrix">Full omega matrix</a><ul class="nav nav-pills nav-stacked">
<li><a href="#create-plot-of-the-model-with-variability">Create plot of the model with variability</a></li>
      <li><a href="#evaluate-designs-with-and-without-covariance-matrix">Evaluate designs (with and without covariance matrix)</a></li>
      <li><a href="#evaluate-the-same-designs-with-full-fim-instead-of-reduced">Evaluate the same designs with full FIM (instead of reduced)</a></li>
      </ul>
</li>
      <li><a href="#include-a-prior-fim-compute-power-to-identify-a-parameter">Include a prior FIM, compute power to identify a parameter</a></li>
      <li>
<a href="#design-evaluation-including-uncertainty-in-the-model-parameters-robust-design">Design evaluation including uncertainty in the model parameters (robust design)</a><ul class="nav nav-pills nav-stacked">
<li><a href="#define-the-model-parameters-for-use-in-poped-db">Define the model parameters for use in poped.db</a></li>
      <li><a href="#define-initial-design-and-design-space">Define initial design and design space</a></li>
      <li><a href="#design-evaluation-1">Design evaluation</a></li>
      </ul>
</li>
      <li>
<a href="#design-evaluation-for-a-subset-of-model-parameters-of-interest-ds-optimality">Design evaluation for a subset of model parameters of interest (Ds optimality)</a><ul class="nav nav-pills nav-stacked">
<li><a href="#define-initial-design-and-design-space-1">Define initial design and design space</a></li>
      <li><a href="#design-evaluation-2">Design evaluation</a></li>
      </ul>
</li>
      <li><a href="#shrinkage">Shrinkage</a></li>
      <li><a href="#further-examples-to-be-implemented">Further examples (to be implemented)</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://katalog.uu.se/profile/?id=N4-631">Andrew C. Hooker</a>, Marco Foracchia, <a href="https://katalog.uu.se/profile/?id=N9-467">Sebastian Ueckert</a>, <a href="https://scholar.google.se/citations?user=4CgHwr0AAAAJ&amp;hl=en">Joakim Nyberg</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
